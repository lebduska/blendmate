<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>blendmate.vendor.websocket._core API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../websocket.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;blendmate.vendor.websocket</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#WebSocket">WebSocket</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#WebSocket.__init__">WebSocket</a>
                        </li>
                        <li>
                                <a class="variable" href="#WebSocket.sock_opt">sock_opt</a>
                        </li>
                        <li>
                                <a class="variable" href="#WebSocket.handshake_response">handshake_response</a>
                        </li>
                        <li>
                                <a class="variable" href="#WebSocket.sock">sock</a>
                        </li>
                        <li>
                                <a class="variable" href="#WebSocket.connected">connected</a>
                        </li>
                        <li>
                                <a class="variable" href="#WebSocket.get_mask_key">get_mask_key</a>
                        </li>
                        <li>
                                <a class="variable" href="#WebSocket.frame_buffer">frame_buffer</a>
                        </li>
                        <li>
                                <a class="variable" href="#WebSocket.cont_frame">cont_frame</a>
                        </li>
                        <li>
                                <a class="variable" href="#WebSocket.dispatcher">dispatcher</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.next">next</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.fileno">fileno</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.set_mask_key">set_mask_key</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.gettimeout">gettimeout</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.settimeout">settimeout</a>
                        </li>
                        <li>
                                <a class="variable" href="#WebSocket.timeout">timeout</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.getsubprotocol">getsubprotocol</a>
                        </li>
                        <li>
                                <a class="variable" href="#WebSocket.subprotocol">subprotocol</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.getstatus">getstatus</a>
                        </li>
                        <li>
                                <a class="variable" href="#WebSocket.status">status</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.getheaders">getheaders</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.is_ssl">is_ssl</a>
                        </li>
                        <li>
                                <a class="variable" href="#WebSocket.headers">headers</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.connect">connect</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.send">send</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.send_text">send_text</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.send_bytes">send_bytes</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.send_frame">send_frame</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.send_binary">send_binary</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.ping">ping</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.pong">pong</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.recv">recv</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.recv_data">recv_data</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.recv_data_frame">recv_data_frame</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.recv_frame">recv_frame</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.send_close">send_close</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.close">close</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.abort">abort</a>
                        </li>
                        <li>
                                <a class="function" href="#WebSocket.shutdown">shutdown</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#create_connection">create_connection</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../../blendmate.html">blendmate</a><wbr>.<a href="./../../vendor.html">vendor</a><wbr>.<a href="./../websocket.html">websocket</a><wbr>._core    </h1>

                
                        <input id="mod-_core-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-_core-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">struct</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="c1"># websocket modules</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._abnf</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABNF</span><span class="p">,</span> <span class="n">STATUS_NORMAL</span><span class="p">,</span> <span class="n">continuous_frame</span><span class="p">,</span> <span class="n">frame_buffer</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>    <span class="n">WebSocketProtocolException</span><span class="p">,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>    <span class="n">WebSocketConnectionClosedException</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>    <span class="n">WebSocketTimeoutException</span><span class="p">,</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="p">)</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._handshake</span><span class="w"> </span><span class="kn">import</span> <span class="n">SUPPORTED_REDIRECT_STATUSES</span><span class="p">,</span> <span class="n">handshake</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._http</span><span class="w"> </span><span class="kn">import</span> <span class="n">connect</span><span class="p">,</span> <span class="n">proxy_info</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">debug</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">isEnabledForError</span><span class="p">,</span> <span class="n">isEnabledForTrace</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._socket</span><span class="w"> </span><span class="kn">import</span> <span class="n">getdefaulttimeout</span><span class="p">,</span> <span class="n">recv</span><span class="p">,</span> <span class="n">send</span><span class="p">,</span> <span class="n">sock_opt</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._ssl_compat</span><span class="w"> </span><span class="kn">import</span> <span class="n">ssl</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">NoLock</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._dispatcher</span><span class="w"> </span><span class="kn">import</span> <span class="n">DispatcherBase</span><span class="p">,</span> <span class="n">WrappedDispatcher</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">_core.py</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">websocket - WebSocket client library for Python</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">Copyright 2025 engn33r</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">you may not use this file except in compliance with the License.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">You may obtain a copy of the License at</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">Unless required by applicable law or agreed to in writing, software</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">See the License for the specific language governing permissions and</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">limitations under the License.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;WebSocket&quot;</span><span class="p">,</span> <span class="s2">&quot;create_connection&quot;</span><span class="p">]</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="k">class</span><span class="w"> </span><span class="nc">WebSocket</span><span class="p">:</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    Low level WebSocket interface.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    This class is based on the WebSocket protocol `draft-hixie-thewebsocketprotocol-76 &lt;http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol-76&gt;`_</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    We can connect to the websocket server and send/receive data.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    The following example is an echo client.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">    &gt;&gt;&gt; import websocket</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    &gt;&gt;&gt; ws = websocket.WebSocket()</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">    &gt;&gt;&gt; ws.connect(&quot;ws://echo.websocket.events&quot;)</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    &gt;&gt;&gt; ws.recv()</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">    &#39;echo.websocket.events sponsored by Lob.com&#39;</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">    &gt;&gt;&gt; ws.send(&quot;Hello, Server&quot;)</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">    19</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    &gt;&gt;&gt; ws.recv()</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">    &#39;Hello, Server&#39;</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">    &gt;&gt;&gt; ws.close()</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    Parameters</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">    ----------</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">    get_mask_key: func</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">        A callable function to get new mask keys, see the</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">        WebSocket.set_mask_key&#39;s docstring for more information.</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">    sockopt: tuple</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        Values for socket.setsockopt.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        sockopt must be tuple and each element is argument of sock.setsockopt.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">    sslopt: dict</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        Optional dict object for ssl socket options. See FAQ for details.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">    fire_cont_frame: bool</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">        Fire recv event for each cont frame. Default is False.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">    enable_multithread: bool</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        If set to True, lock send method.</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">    skip_utf8_validation: bool</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">        Skip utf8 validation.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="n">get_mask_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="n">sockopt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="n">sslopt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="n">fire_cont_frame</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="n">enable_multithread</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        <span class="n">skip_utf8_validation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="n">dispatcher</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DispatcherBase</span><span class="p">,</span> <span class="n">WrappedDispatcher</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>        <span class="o">**</span><span class="n">_</span><span class="p">,</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>    <span class="p">):</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">        Initialize WebSocket object.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">        Parameters</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        ----------</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        sslopt: dict</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">            Optional dict object for ssl socket options. See FAQ for details.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span> <span class="o">=</span> <span class="n">sock_opt</span><span class="p">(</span><span class="n">sockopt</span><span class="p">,</span> <span class="n">sslopt</span><span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_mask_key</span> <span class="o">=</span> <span class="n">get_mask_key</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>        <span class="c1"># These buffer over the build-up of a single frame.</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">frame_buffer</span> <span class="o">=</span> <span class="n">frame_buffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recv</span><span class="p">,</span> <span class="n">skip_utf8_validation</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span> <span class="o">=</span> <span class="n">continuous_frame</span><span class="p">(</span><span class="n">fire_cont_frame</span><span class="p">,</span> <span class="n">skip_utf8_validation</span><span class="p">)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispatcher</span> <span class="o">=</span> <span class="n">dispatcher</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="n">enable_multithread</span><span class="p">:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">readlock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">NoLock</span><span class="p">()</span>  <span class="c1"># type: ignore[assignment]</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">readlock</span> <span class="o">=</span> <span class="n">NoLock</span><span class="p">()</span>  <span class="c1"># type: ignore[assignment]</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        Allow iteration over websocket, implying sequential `recv` executions.</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fileno</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_mask_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">        Set function to create mask key. You can customize mask key generator.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        Mainly, this is for testing purpose.</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">        Parameters</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">        ----------</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">        func: func</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">            callable object. the func takes 1 argument as integer.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">            The argument means length of mask key.</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">            This func must return string(byte array),</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">            which length is argument specified.</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_mask_key</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gettimeout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">        Get the websocket timeout (in seconds) as an int or float</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">        Returns</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">        ----------</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">        timeout: int or float</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">             returns timeout value (in seconds). This value could be either float/integer.</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="o">.</span><span class="n">timeout</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">settimeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]):</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        Set the timeout to the websocket.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        Parameters</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">        ----------</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        timeout: int or float</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">            timeout time (in seconds). This value could be either float/integer.</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>    <span class="n">timeout</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">gettimeout</span><span class="p">,</span> <span class="n">settimeout</span><span class="p">)</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getsubprotocol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">        Get subprotocol</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="p">:</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">subprotocol</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>    <span class="n">subprotocol</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getsubprotocol</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getstatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">        Get handshake status</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="p">:</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">status</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    <span class="n">status</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getstatus</span><span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getheaders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        Get handshake response header</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="p">:</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">headers</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_ssl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>    <span class="n">headers</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getheaders</span><span class="p">)</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">        Connect to url. url is websocket url scheme.</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        ie. ws://host:port/resource</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">        You can customize using &#39;options&#39;.</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">        If you set &quot;header&quot; list object, you can set your own custom header.</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">        &gt;&gt;&gt; ws = WebSocket()</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">        &gt;&gt;&gt; ws.connect(&quot;ws://echo.websocket.events&quot;,</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">                ...     header=[&quot;User-Agent: MyProgram&quot;,</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">                ...             &quot;x-custom: header&quot;])</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        Parameters</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">        ----------</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">        header: list or dict</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">            Custom http header list or dict.</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">        cookie: str</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">            Cookie value.</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">        origin: str</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">            Custom origin url.</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">        connection: str</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">            Custom connection header value.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">            Default value &quot;Upgrade&quot; set in _handshake.py</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">        suppress_origin: bool</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">            Suppress outputting origin header.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">        host: str</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">            Custom host header string.</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        timeout: int or float</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">            Socket timeout time. This value is an integer or float.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">            If you set None for this value, it means &quot;use default_timeout value&quot;</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">        http_proxy_host: str</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">            HTTP proxy host name.</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">        http_proxy_port: str or int</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">            HTTP proxy port. Default is 80.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">        http_no_proxy: list</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">            Whitelisted host names that don&#39;t use the proxy.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">        http_proxy_auth: tuple</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">            HTTP proxy auth information. Tuple of username and password. Default is None.</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">        http_proxy_timeout: int or float</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">            HTTP proxy timeout, default is 60 sec as per python-socks.</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">        redirect_limit: int</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">            Number of redirects to follow.</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">        subprotocols: list</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="sd">            List of available subprotocols. Default is None.</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">        socket: socket</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">            Pre-initialized stream socket.</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">addrs</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="p">,</span> <span class="n">proxy_info</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">),</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;socket&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span> <span class="o">=</span> <span class="n">handshake</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">*</span><span class="n">addrs</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;redirect_limit&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="n">SUPPORTED_REDIRECT_STATUSES</span><span class="p">:</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>                    <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">addrs</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>                        <span class="n">url</span><span class="p">,</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="p">,</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>                        <span class="n">proxy_info</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">),</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>                        <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;socket&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>                    <span class="p">)</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span> <span class="o">=</span> <span class="n">handshake</span><span class="p">(</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">*</span><span class="n">addrs</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>                    <span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>            <span class="k">raise</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">opcode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_TEXT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">        Send the data as string.</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">        Parameters</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">        ----------</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">        payload: str</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">            Payload must be utf-8 string or unicode,</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">            If the opcode is OPCODE_TEXT.</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">            Otherwise, it must be string(byte array).</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">        opcode: int</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">            Operation code (opcode) to send.</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>        <span class="n">frame</span> <span class="o">=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">create_frame</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">opcode</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        Sends UTF-8 encoded text.</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">text_data</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_TEXT</span><span class="p">)</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">        Sends a sequence of bytes.</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_BINARY</span><span class="p">)</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">        Send the data frame.</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">        &gt;&gt;&gt; ws = create_connection(&quot;ws://echo.websocket.events&quot;)</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">        &gt;&gt;&gt; frame = ABNF.create_frame(&quot;Hello&quot;, ABNF.OPCODE_TEXT)</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">        &gt;&gt;&gt; ws.send_frame(frame)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">        &gt;&gt;&gt; cont_frame = ABNF.create_frame(&quot;My name is &quot;, ABNF.OPCODE_CONT, 0)</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">        &gt;&gt;&gt; ws.send_frame(frame)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">        &gt;&gt;&gt; cont_frame = ABNF.create_frame(&quot;Foo Bar&quot;, ABNF.OPCODE_CONT, 1)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">        &gt;&gt;&gt; ws.send_frame(frame)</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">        Parameters</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">        ----------</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">        frame: ABNF frame</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">            frame data created by ABNF.create_frame</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mask_key</span><span class="p">:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>            <span class="n">frame</span><span class="o">.</span><span class="n">get_mask_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mask_key</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="k">if</span> <span class="n">isEnabledForTrace</span><span class="p">():</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;++Sent raw: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;++Sent decoded: </span><span class="si">{</span><span class="n">frame</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>            <span class="k">while</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>                <span class="n">bytes_sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">bytes_sent</span><span class="p">:]</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>        <span class="k">return</span> <span class="n">length</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="sd">        Send a binary message (OPCODE_BINARY).</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">        Parameters</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">        ----------</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">        payload: bytes</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">            payload of message to send.</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_BINARY</span><span class="p">)</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">        Send ping data.</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">        Parameters</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">        ----------</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">        payload: str</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="sd">            data payload to send server.</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_PING</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">pong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">        Send pong data.</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">        Parameters</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">        ----------</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">        payload: str</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">            data payload to send server.</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_PONG</span><span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recv</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">        Receive string data(byte array) from the server.</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">        Returns</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        ----------</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">        data: string (byte array) value.</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">readlock</span><span class="p">:</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>            <span class="n">opcode</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_data</span><span class="p">()</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>        <span class="k">if</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_TEXT</span><span class="p">:</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>            <span class="n">data_received</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_received</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>                <span class="k">return</span> <span class="n">data_received</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_received</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>                <span class="k">return</span> <span class="n">data_received</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_BINARY</span><span class="p">:</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>            <span class="n">data_binary</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>            <span class="k">return</span> <span class="n">data_binary</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recv_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_frame</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">        Receive data with operation code.</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">        Parameters</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">        ----------</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">        control_frame: bool</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">            a boolean flag indicating whether to return control frame</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">            data, defaults to False</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">        Returns</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">        -------</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">        opcode, frame.data: tuple</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">            tuple of operation code and string(byte array) value.</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>        <span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_data_frame</span><span class="p">(</span><span class="n">control_frame</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="k">return</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">data</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recv_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_frame</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">        Receive data with operation code.</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">        If a valid ping message is received, a pong response is sent.</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">        Parameters</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a><span class="sd">        ----------</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="sd">        control_frame: bool</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="sd">            a boolean flag indicating whether to return control frame</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">            data, defaults to False</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">        Returns</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">        -------</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">        frame.opcode, frame: tuple</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">            tuple of operation code and string(byte array) value.</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_frame</span><span class="p">()</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>            <span class="k">if</span> <span class="n">isEnabledForTrace</span><span class="p">():</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>                <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;++Rcv raw: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">format</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>                <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;++Rcv decoded: </span><span class="si">{</span><span class="n">frame</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">frame</span><span class="p">:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>                <span class="c1"># handle error:</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>                <span class="c1"># &#39;NoneType&#39; object has no attribute &#39;opcode&#39;</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>                <span class="k">raise</span> <span class="n">WebSocketProtocolException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not a valid frame </span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>            <span class="k">elif</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="ow">in</span> <span class="p">(</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>                <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_TEXT</span><span class="p">,</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>                <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_BINARY</span><span class="p">,</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>                <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CONT</span><span class="p">,</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>            <span class="p">):</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span><span class="o">.</span><span class="n">is_fire</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>            <span class="k">elif</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CLOSE</span><span class="p">:</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">send_close</span><span class="p">()</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>                <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>            <span class="k">elif</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_PING</span><span class="p">:</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">126</span><span class="p">:</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pong</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>                    <span class="k">raise</span> <span class="n">WebSocketProtocolException</span><span class="p">(</span><span class="s2">&quot;Ping message is too long&quot;</span><span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>                <span class="k">if</span> <span class="n">control_frame</span><span class="p">:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>                    <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>            <span class="k">elif</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_PONG</span><span class="p">:</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>                <span class="k">if</span> <span class="n">control_frame</span><span class="p">:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>                    <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recv_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">        Receive data as frame from server.</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">        Returns</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">        -------</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">        self.frame_buffer.recv_frame(): ABNF frame object</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_buffer</span><span class="o">.</span><span class="n">recv_frame</span><span class="p">()</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">STATUS_NORMAL</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">        Send close data to the server.</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">        Parameters</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="sd">        ----------</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="sd">        status: int</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="sd">            Status code to send. See STATUS_XXX.</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">        reason: str or bytes</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">            The reason to close. This must be string or UTF-8 bytes.</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">&gt;=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">LENGTH_16</span><span class="p">:</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;code is invalid range&quot;</span><span class="p">)</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;!H&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span> <span class="o">+</span> <span class="n">reason</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CLOSE</span><span class="p">)</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">STATUS_NORMAL</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="sd">        Close Websocket object</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">        Parameters</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">        ----------</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">        status: int</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">            Status code to send. See VALID_CLOSE_STATUS in ABNF.</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">        reason: bytes</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">            The reason to close in UTF-8.</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">        timeout: int or float</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">            Timeout until receive a close frame.</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">            If None, it will wait forever until receive a close frame.</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>            <span class="k">return</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">&gt;=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">LENGTH_16</span><span class="p">:</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;code is invalid range&quot;</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;!H&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span> <span class="o">+</span> <span class="n">reason</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CLOSE</span><span class="p">)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>                <span class="k">return</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>            <span class="n">sock_timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">gettimeout</span><span class="p">()</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>            <span class="k">while</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>                    <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_frame</span><span class="p">()</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>                    <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="o">!=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CLOSE</span><span class="p">:</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>                        <span class="k">continue</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>                    <span class="k">if</span> <span class="n">isEnabledForError</span><span class="p">():</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>                        <span class="n">recv_status</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;!H&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>                        <span class="k">if</span> <span class="n">recv_status</span> <span class="o">&gt;=</span> <span class="mi">3000</span> <span class="ow">and</span> <span class="n">recv_status</span> <span class="o">&lt;=</span> <span class="mi">4999</span><span class="p">:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>                            <span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;close status: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">recv_status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>                        <span class="k">elif</span> <span class="n">recv_status</span> <span class="o">!=</span> <span class="n">STATUS_NORMAL</span><span class="p">:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>                            <span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;close status: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">recv_status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>                    <span class="k">break</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>                <span class="k">except</span> <span class="p">(</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>                    <span class="n">WebSocketConnectionClosedException</span><span class="p">,</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>                    <span class="n">WebSocketTimeoutException</span><span class="p">,</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>                    <span class="n">struct</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>                <span class="p">):</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>                    <span class="k">break</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">sock_timeout</span><span class="p">)</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_RDWR</span><span class="p">)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>            <span class="k">pass</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a><span class="sd">        Low-level asynchronous abort, wakes up other threads that are waiting in recv_*</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_RDWR</span><span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a><span class="sd">        close socket, immediately.</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]):</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>            <span class="k">raise</span> <span class="n">WebSocketConnectionClosedException</span><span class="p">(</span><span class="s2">&quot;socket is already closed.&quot;</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatcher</span><span class="p">:</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatcher</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>        <span class="k">return</span> <span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_recv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">):</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>            <span class="k">return</span> <span class="n">recv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">)</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>        <span class="k">except</span> <span class="n">WebSocketConnectionClosedException</span><span class="p">:</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>            <span class="k">raise</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="k">def</span><span class="w"> </span><span class="nf">create_connection</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="n">WebSocket</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a><span class="sd">    Connect to url and return websocket object.</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="sd">    Connect to url and return the WebSocket object.</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a><span class="sd">    Passing optional timeout parameter will set the timeout on the socket.</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="sd">    If no timeout is supplied,</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">    the global default timeout setting returned by getdefaulttimeout() is used.</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">    You can customize using &#39;options&#39;.</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">    If you set &quot;header&quot; list object, you can set your own custom header.</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a><span class="sd">    &gt;&gt;&gt; conn = create_connection(&quot;ws://echo.websocket.events&quot;,</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a><span class="sd">         ...     header=[&quot;User-Agent: MyProgram&quot;,</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">         ...             &quot;x-custom: header&quot;])</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="sd">    Parameters</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a><span class="sd">    ----------</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a><span class="sd">    class_: class</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a><span class="sd">        class to instantiate when creating the connection. It has to implement</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a><span class="sd">        settimeout and connect. It&#39;s __init__ should be compatible with</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a><span class="sd">        WebSocket.__init__, i.e. accept all of it&#39;s kwargs.</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a><span class="sd">    header: list or dict</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a><span class="sd">        custom http header list or dict.</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a><span class="sd">    cookie: str</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a><span class="sd">        Cookie value.</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a><span class="sd">    origin: str</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a><span class="sd">        custom origin url.</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a><span class="sd">    suppress_origin: bool</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a><span class="sd">        suppress outputting origin header.</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a><span class="sd">    host: str</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a><span class="sd">        custom host header string.</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a><span class="sd">    timeout: int or float</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a><span class="sd">        socket timeout time. This value could be either float/integer.</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a><span class="sd">        If set to None, it uses the default_timeout value.</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a><span class="sd">    http_proxy_host: str</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a><span class="sd">        HTTP proxy host name.</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a><span class="sd">    http_proxy_port: str or int</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a><span class="sd">        HTTP proxy port. If not set, set to 80.</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a><span class="sd">    http_no_proxy: list</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a><span class="sd">        Whitelisted host names that don&#39;t use the proxy.</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a><span class="sd">    http_proxy_auth: tuple</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a><span class="sd">        HTTP proxy auth information. tuple of username and password. Default is None.</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a><span class="sd">    http_proxy_timeout: int or float</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a><span class="sd">        HTTP proxy timeout, default is 60 sec as per python-socks.</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a><span class="sd">    enable_multithread: bool</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a><span class="sd">        Enable lock for multithread.</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a><span class="sd">    redirect_limit: int</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a><span class="sd">        Number of redirects to follow.</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a><span class="sd">    sockopt: tuple</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a><span class="sd">        Values for socket.setsockopt.</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a><span class="sd">        sockopt must be a tuple and each element is an argument of sock.setsockopt.</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a><span class="sd">    sslopt: dict</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a><span class="sd">        Optional dict object for ssl socket options. See FAQ for details.</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a><span class="sd">    subprotocols: list</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a><span class="sd">        List of available subprotocols. Default is None.</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a><span class="sd">    skip_utf8_validation: bool</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a><span class="sd">        Skip utf8 validation.</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a><span class="sd">    socket: socket</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a><span class="sd">        Pre-initialized stream socket.</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>    <span class="n">sockopt</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;sockopt&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>    <span class="n">sslopt</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;sslopt&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>    <span class="n">fire_cont_frame</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fire_cont_frame&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>    <span class="n">enable_multithread</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;enable_multithread&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>    <span class="n">skip_utf8_validation</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;skip_utf8_validation&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>    <span class="n">websock</span> <span class="o">=</span> <span class="n">class_</span><span class="p">(</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>        <span class="n">sockopt</span><span class="o">=</span><span class="n">sockopt</span><span class="p">,</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>        <span class="n">sslopt</span><span class="o">=</span><span class="n">sslopt</span><span class="p">,</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>        <span class="n">fire_cont_frame</span><span class="o">=</span><span class="n">fire_cont_frame</span><span class="p">,</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>        <span class="n">enable_multithread</span><span class="o">=</span><span class="n">enable_multithread</span><span class="p">,</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>        <span class="n">skip_utf8_validation</span><span class="o">=</span><span class="n">skip_utf8_validation</span><span class="p">,</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>        <span class="o">**</span><span class="n">options</span><span class="p">,</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>    <span class="p">)</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>    <span class="n">websock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">timeout</span> <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">getdefaulttimeout</span><span class="p">())</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>    <span class="n">websock</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>    <span class="k">return</span> <span class="n">websock</span>
</span></pre></div>


            </section>
                <section id="WebSocket">
                            <input id="WebSocket-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">WebSocket</span>:

                <label class="view-source-button" for="WebSocket-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket-45"><a href="#WebSocket-45"><span class="linenos"> 45</span></a><span class="k">class</span><span class="w"> </span><span class="nc">WebSocket</span><span class="p">:</span>
</span><span id="WebSocket-46"><a href="#WebSocket-46"><span class="linenos"> 46</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-47"><a href="#WebSocket-47"><span class="linenos"> 47</span></a><span class="sd">    Low level WebSocket interface.</span>
</span><span id="WebSocket-48"><a href="#WebSocket-48"><span class="linenos"> 48</span></a>
</span><span id="WebSocket-49"><a href="#WebSocket-49"><span class="linenos"> 49</span></a><span class="sd">    This class is based on the WebSocket protocol `draft-hixie-thewebsocketprotocol-76 &lt;http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol-76&gt;`_</span>
</span><span id="WebSocket-50"><a href="#WebSocket-50"><span class="linenos"> 50</span></a>
</span><span id="WebSocket-51"><a href="#WebSocket-51"><span class="linenos"> 51</span></a><span class="sd">    We can connect to the websocket server and send/receive data.</span>
</span><span id="WebSocket-52"><a href="#WebSocket-52"><span class="linenos"> 52</span></a><span class="sd">    The following example is an echo client.</span>
</span><span id="WebSocket-53"><a href="#WebSocket-53"><span class="linenos"> 53</span></a>
</span><span id="WebSocket-54"><a href="#WebSocket-54"><span class="linenos"> 54</span></a><span class="sd">    &gt;&gt;&gt; import websocket</span>
</span><span id="WebSocket-55"><a href="#WebSocket-55"><span class="linenos"> 55</span></a><span class="sd">    &gt;&gt;&gt; ws = websocket.WebSocket()</span>
</span><span id="WebSocket-56"><a href="#WebSocket-56"><span class="linenos"> 56</span></a><span class="sd">    &gt;&gt;&gt; ws.connect(&quot;ws://echo.websocket.events&quot;)</span>
</span><span id="WebSocket-57"><a href="#WebSocket-57"><span class="linenos"> 57</span></a><span class="sd">    &gt;&gt;&gt; ws.recv()</span>
</span><span id="WebSocket-58"><a href="#WebSocket-58"><span class="linenos"> 58</span></a><span class="sd">    &#39;echo.websocket.events sponsored by Lob.com&#39;</span>
</span><span id="WebSocket-59"><a href="#WebSocket-59"><span class="linenos"> 59</span></a><span class="sd">    &gt;&gt;&gt; ws.send(&quot;Hello, Server&quot;)</span>
</span><span id="WebSocket-60"><a href="#WebSocket-60"><span class="linenos"> 60</span></a><span class="sd">    19</span>
</span><span id="WebSocket-61"><a href="#WebSocket-61"><span class="linenos"> 61</span></a><span class="sd">    &gt;&gt;&gt; ws.recv()</span>
</span><span id="WebSocket-62"><a href="#WebSocket-62"><span class="linenos"> 62</span></a><span class="sd">    &#39;Hello, Server&#39;</span>
</span><span id="WebSocket-63"><a href="#WebSocket-63"><span class="linenos"> 63</span></a><span class="sd">    &gt;&gt;&gt; ws.close()</span>
</span><span id="WebSocket-64"><a href="#WebSocket-64"><span class="linenos"> 64</span></a>
</span><span id="WebSocket-65"><a href="#WebSocket-65"><span class="linenos"> 65</span></a><span class="sd">    Parameters</span>
</span><span id="WebSocket-66"><a href="#WebSocket-66"><span class="linenos"> 66</span></a><span class="sd">    ----------</span>
</span><span id="WebSocket-67"><a href="#WebSocket-67"><span class="linenos"> 67</span></a><span class="sd">    get_mask_key: func</span>
</span><span id="WebSocket-68"><a href="#WebSocket-68"><span class="linenos"> 68</span></a><span class="sd">        A callable function to get new mask keys, see the</span>
</span><span id="WebSocket-69"><a href="#WebSocket-69"><span class="linenos"> 69</span></a><span class="sd">        WebSocket.set_mask_key&#39;s docstring for more information.</span>
</span><span id="WebSocket-70"><a href="#WebSocket-70"><span class="linenos"> 70</span></a><span class="sd">    sockopt: tuple</span>
</span><span id="WebSocket-71"><a href="#WebSocket-71"><span class="linenos"> 71</span></a><span class="sd">        Values for socket.setsockopt.</span>
</span><span id="WebSocket-72"><a href="#WebSocket-72"><span class="linenos"> 72</span></a><span class="sd">        sockopt must be tuple and each element is argument of sock.setsockopt.</span>
</span><span id="WebSocket-73"><a href="#WebSocket-73"><span class="linenos"> 73</span></a><span class="sd">    sslopt: dict</span>
</span><span id="WebSocket-74"><a href="#WebSocket-74"><span class="linenos"> 74</span></a><span class="sd">        Optional dict object for ssl socket options. See FAQ for details.</span>
</span><span id="WebSocket-75"><a href="#WebSocket-75"><span class="linenos"> 75</span></a><span class="sd">    fire_cont_frame: bool</span>
</span><span id="WebSocket-76"><a href="#WebSocket-76"><span class="linenos"> 76</span></a><span class="sd">        Fire recv event for each cont frame. Default is False.</span>
</span><span id="WebSocket-77"><a href="#WebSocket-77"><span class="linenos"> 77</span></a><span class="sd">    enable_multithread: bool</span>
</span><span id="WebSocket-78"><a href="#WebSocket-78"><span class="linenos"> 78</span></a><span class="sd">        If set to True, lock send method.</span>
</span><span id="WebSocket-79"><a href="#WebSocket-79"><span class="linenos"> 79</span></a><span class="sd">    skip_utf8_validation: bool</span>
</span><span id="WebSocket-80"><a href="#WebSocket-80"><span class="linenos"> 80</span></a><span class="sd">        Skip utf8 validation.</span>
</span><span id="WebSocket-81"><a href="#WebSocket-81"><span class="linenos"> 81</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="WebSocket-82"><a href="#WebSocket-82"><span class="linenos"> 82</span></a>
</span><span id="WebSocket-83"><a href="#WebSocket-83"><span class="linenos"> 83</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="WebSocket-84"><a href="#WebSocket-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="WebSocket-85"><a href="#WebSocket-85"><span class="linenos"> 85</span></a>        <span class="n">get_mask_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="WebSocket-86"><a href="#WebSocket-86"><span class="linenos"> 86</span></a>        <span class="n">sockopt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="WebSocket-87"><a href="#WebSocket-87"><span class="linenos"> 87</span></a>        <span class="n">sslopt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="WebSocket-88"><a href="#WebSocket-88"><span class="linenos"> 88</span></a>        <span class="n">fire_cont_frame</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="WebSocket-89"><a href="#WebSocket-89"><span class="linenos"> 89</span></a>        <span class="n">enable_multithread</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="WebSocket-90"><a href="#WebSocket-90"><span class="linenos"> 90</span></a>        <span class="n">skip_utf8_validation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="WebSocket-91"><a href="#WebSocket-91"><span class="linenos"> 91</span></a>        <span class="n">dispatcher</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DispatcherBase</span><span class="p">,</span> <span class="n">WrappedDispatcher</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="WebSocket-92"><a href="#WebSocket-92"><span class="linenos"> 92</span></a>        <span class="o">**</span><span class="n">_</span><span class="p">,</span>
</span><span id="WebSocket-93"><a href="#WebSocket-93"><span class="linenos"> 93</span></a>    <span class="p">):</span>
</span><span id="WebSocket-94"><a href="#WebSocket-94"><span class="linenos"> 94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-95"><a href="#WebSocket-95"><span class="linenos"> 95</span></a><span class="sd">        Initialize WebSocket object.</span>
</span><span id="WebSocket-96"><a href="#WebSocket-96"><span class="linenos"> 96</span></a>
</span><span id="WebSocket-97"><a href="#WebSocket-97"><span class="linenos"> 97</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket-98"><a href="#WebSocket-98"><span class="linenos"> 98</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-99"><a href="#WebSocket-99"><span class="linenos"> 99</span></a><span class="sd">        sslopt: dict</span>
</span><span id="WebSocket-100"><a href="#WebSocket-100"><span class="linenos">100</span></a><span class="sd">            Optional dict object for ssl socket options. See FAQ for details.</span>
</span><span id="WebSocket-101"><a href="#WebSocket-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-102"><a href="#WebSocket-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span> <span class="o">=</span> <span class="n">sock_opt</span><span class="p">(</span><span class="n">sockopt</span><span class="p">,</span> <span class="n">sslopt</span><span class="p">)</span>
</span><span id="WebSocket-103"><a href="#WebSocket-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WebSocket-104"><a href="#WebSocket-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WebSocket-105"><a href="#WebSocket-105"><span class="linenos">105</span></a>
</span><span id="WebSocket-106"><a href="#WebSocket-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="WebSocket-107"><a href="#WebSocket-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_mask_key</span> <span class="o">=</span> <span class="n">get_mask_key</span>
</span><span id="WebSocket-108"><a href="#WebSocket-108"><span class="linenos">108</span></a>        <span class="c1"># These buffer over the build-up of a single frame.</span>
</span><span id="WebSocket-109"><a href="#WebSocket-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">frame_buffer</span> <span class="o">=</span> <span class="n">frame_buffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recv</span><span class="p">,</span> <span class="n">skip_utf8_validation</span><span class="p">)</span>
</span><span id="WebSocket-110"><a href="#WebSocket-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span> <span class="o">=</span> <span class="n">continuous_frame</span><span class="p">(</span><span class="n">fire_cont_frame</span><span class="p">,</span> <span class="n">skip_utf8_validation</span><span class="p">)</span>
</span><span id="WebSocket-111"><a href="#WebSocket-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispatcher</span> <span class="o">=</span> <span class="n">dispatcher</span>
</span><span id="WebSocket-112"><a href="#WebSocket-112"><span class="linenos">112</span></a>
</span><span id="WebSocket-113"><a href="#WebSocket-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="n">enable_multithread</span><span class="p">:</span>
</span><span id="WebSocket-114"><a href="#WebSocket-114"><span class="linenos">114</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="WebSocket-115"><a href="#WebSocket-115"><span class="linenos">115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">readlock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="WebSocket-116"><a href="#WebSocket-116"><span class="linenos">116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket-117"><a href="#WebSocket-117"><span class="linenos">117</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">NoLock</span><span class="p">()</span>  <span class="c1"># type: ignore[assignment]</span>
</span><span id="WebSocket-118"><a href="#WebSocket-118"><span class="linenos">118</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">readlock</span> <span class="o">=</span> <span class="n">NoLock</span><span class="p">()</span>  <span class="c1"># type: ignore[assignment]</span>
</span><span id="WebSocket-119"><a href="#WebSocket-119"><span class="linenos">119</span></a>
</span><span id="WebSocket-120"><a href="#WebSocket-120"><span class="linenos">120</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket-121"><a href="#WebSocket-121"><span class="linenos">121</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-122"><a href="#WebSocket-122"><span class="linenos">122</span></a><span class="sd">        Allow iteration over websocket, implying sequential `recv` executions.</span>
</span><span id="WebSocket-123"><a href="#WebSocket-123"><span class="linenos">123</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-124"><a href="#WebSocket-124"><span class="linenos">124</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="WebSocket-125"><a href="#WebSocket-125"><span class="linenos">125</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span><span id="WebSocket-126"><a href="#WebSocket-126"><span class="linenos">126</span></a>
</span><span id="WebSocket-127"><a href="#WebSocket-127"><span class="linenos">127</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket-128"><a href="#WebSocket-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span><span id="WebSocket-129"><a href="#WebSocket-129"><span class="linenos">129</span></a>
</span><span id="WebSocket-130"><a href="#WebSocket-130"><span class="linenos">130</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket-131"><a href="#WebSocket-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>
</span><span id="WebSocket-132"><a href="#WebSocket-132"><span class="linenos">132</span></a>
</span><span id="WebSocket-133"><a href="#WebSocket-133"><span class="linenos">133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fileno</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket-134"><a href="#WebSocket-134"><span class="linenos">134</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
</span><span id="WebSocket-135"><a href="#WebSocket-135"><span class="linenos">135</span></a>
</span><span id="WebSocket-136"><a href="#WebSocket-136"><span class="linenos">136</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_mask_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
</span><span id="WebSocket-137"><a href="#WebSocket-137"><span class="linenos">137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-138"><a href="#WebSocket-138"><span class="linenos">138</span></a><span class="sd">        Set function to create mask key. You can customize mask key generator.</span>
</span><span id="WebSocket-139"><a href="#WebSocket-139"><span class="linenos">139</span></a><span class="sd">        Mainly, this is for testing purpose.</span>
</span><span id="WebSocket-140"><a href="#WebSocket-140"><span class="linenos">140</span></a>
</span><span id="WebSocket-141"><a href="#WebSocket-141"><span class="linenos">141</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket-142"><a href="#WebSocket-142"><span class="linenos">142</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-143"><a href="#WebSocket-143"><span class="linenos">143</span></a><span class="sd">        func: func</span>
</span><span id="WebSocket-144"><a href="#WebSocket-144"><span class="linenos">144</span></a><span class="sd">            callable object. the func takes 1 argument as integer.</span>
</span><span id="WebSocket-145"><a href="#WebSocket-145"><span class="linenos">145</span></a><span class="sd">            The argument means length of mask key.</span>
</span><span id="WebSocket-146"><a href="#WebSocket-146"><span class="linenos">146</span></a><span class="sd">            This func must return string(byte array),</span>
</span><span id="WebSocket-147"><a href="#WebSocket-147"><span class="linenos">147</span></a><span class="sd">            which length is argument specified.</span>
</span><span id="WebSocket-148"><a href="#WebSocket-148"><span class="linenos">148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-149"><a href="#WebSocket-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_mask_key</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="WebSocket-150"><a href="#WebSocket-150"><span class="linenos">150</span></a>
</span><span id="WebSocket-151"><a href="#WebSocket-151"><span class="linenos">151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gettimeout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="WebSocket-152"><a href="#WebSocket-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-153"><a href="#WebSocket-153"><span class="linenos">153</span></a><span class="sd">        Get the websocket timeout (in seconds) as an int or float</span>
</span><span id="WebSocket-154"><a href="#WebSocket-154"><span class="linenos">154</span></a>
</span><span id="WebSocket-155"><a href="#WebSocket-155"><span class="linenos">155</span></a><span class="sd">        Returns</span>
</span><span id="WebSocket-156"><a href="#WebSocket-156"><span class="linenos">156</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-157"><a href="#WebSocket-157"><span class="linenos">157</span></a><span class="sd">        timeout: int or float</span>
</span><span id="WebSocket-158"><a href="#WebSocket-158"><span class="linenos">158</span></a><span class="sd">             returns timeout value (in seconds). This value could be either float/integer.</span>
</span><span id="WebSocket-159"><a href="#WebSocket-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-160"><a href="#WebSocket-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="o">.</span><span class="n">timeout</span>
</span><span id="WebSocket-161"><a href="#WebSocket-161"><span class="linenos">161</span></a>
</span><span id="WebSocket-162"><a href="#WebSocket-162"><span class="linenos">162</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">settimeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]):</span>
</span><span id="WebSocket-163"><a href="#WebSocket-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-164"><a href="#WebSocket-164"><span class="linenos">164</span></a><span class="sd">        Set the timeout to the websocket.</span>
</span><span id="WebSocket-165"><a href="#WebSocket-165"><span class="linenos">165</span></a>
</span><span id="WebSocket-166"><a href="#WebSocket-166"><span class="linenos">166</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket-167"><a href="#WebSocket-167"><span class="linenos">167</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-168"><a href="#WebSocket-168"><span class="linenos">168</span></a><span class="sd">        timeout: int or float</span>
</span><span id="WebSocket-169"><a href="#WebSocket-169"><span class="linenos">169</span></a><span class="sd">            timeout time (in seconds). This value could be either float/integer.</span>
</span><span id="WebSocket-170"><a href="#WebSocket-170"><span class="linenos">170</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-171"><a href="#WebSocket-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
</span><span id="WebSocket-172"><a href="#WebSocket-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span>
</span><span id="WebSocket-173"><a href="#WebSocket-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="WebSocket-174"><a href="#WebSocket-174"><span class="linenos">174</span></a>
</span><span id="WebSocket-175"><a href="#WebSocket-175"><span class="linenos">175</span></a>    <span class="n">timeout</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">gettimeout</span><span class="p">,</span> <span class="n">settimeout</span><span class="p">)</span>
</span><span id="WebSocket-176"><a href="#WebSocket-176"><span class="linenos">176</span></a>
</span><span id="WebSocket-177"><a href="#WebSocket-177"><span class="linenos">177</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getsubprotocol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket-178"><a href="#WebSocket-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-179"><a href="#WebSocket-179"><span class="linenos">179</span></a><span class="sd">        Get subprotocol</span>
</span><span id="WebSocket-180"><a href="#WebSocket-180"><span class="linenos">180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-181"><a href="#WebSocket-181"><span class="linenos">181</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="p">:</span>
</span><span id="WebSocket-182"><a href="#WebSocket-182"><span class="linenos">182</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">subprotocol</span>
</span><span id="WebSocket-183"><a href="#WebSocket-183"><span class="linenos">183</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket-184"><a href="#WebSocket-184"><span class="linenos">184</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="WebSocket-185"><a href="#WebSocket-185"><span class="linenos">185</span></a>
</span><span id="WebSocket-186"><a href="#WebSocket-186"><span class="linenos">186</span></a>    <span class="n">subprotocol</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getsubprotocol</span><span class="p">)</span>
</span><span id="WebSocket-187"><a href="#WebSocket-187"><span class="linenos">187</span></a>
</span><span id="WebSocket-188"><a href="#WebSocket-188"><span class="linenos">188</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getstatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket-189"><a href="#WebSocket-189"><span class="linenos">189</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-190"><a href="#WebSocket-190"><span class="linenos">190</span></a><span class="sd">        Get handshake status</span>
</span><span id="WebSocket-191"><a href="#WebSocket-191"><span class="linenos">191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-192"><a href="#WebSocket-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="p">:</span>
</span><span id="WebSocket-193"><a href="#WebSocket-193"><span class="linenos">193</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">status</span>
</span><span id="WebSocket-194"><a href="#WebSocket-194"><span class="linenos">194</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket-195"><a href="#WebSocket-195"><span class="linenos">195</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="WebSocket-196"><a href="#WebSocket-196"><span class="linenos">196</span></a>
</span><span id="WebSocket-197"><a href="#WebSocket-197"><span class="linenos">197</span></a>    <span class="n">status</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getstatus</span><span class="p">)</span>
</span><span id="WebSocket-198"><a href="#WebSocket-198"><span class="linenos">198</span></a>
</span><span id="WebSocket-199"><a href="#WebSocket-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getheaders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket-200"><a href="#WebSocket-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-201"><a href="#WebSocket-201"><span class="linenos">201</span></a><span class="sd">        Get handshake response header</span>
</span><span id="WebSocket-202"><a href="#WebSocket-202"><span class="linenos">202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-203"><a href="#WebSocket-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="p">:</span>
</span><span id="WebSocket-204"><a href="#WebSocket-204"><span class="linenos">204</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">headers</span>
</span><span id="WebSocket-205"><a href="#WebSocket-205"><span class="linenos">205</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket-206"><a href="#WebSocket-206"><span class="linenos">206</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="WebSocket-207"><a href="#WebSocket-207"><span class="linenos">207</span></a>
</span><span id="WebSocket-208"><a href="#WebSocket-208"><span class="linenos">208</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_ssl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket-209"><a href="#WebSocket-209"><span class="linenos">209</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="WebSocket-210"><a href="#WebSocket-210"><span class="linenos">210</span></a>            <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>
</span><span id="WebSocket-211"><a href="#WebSocket-211"><span class="linenos">211</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
</span><span id="WebSocket-212"><a href="#WebSocket-212"><span class="linenos">212</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="WebSocket-213"><a href="#WebSocket-213"><span class="linenos">213</span></a>
</span><span id="WebSocket-214"><a href="#WebSocket-214"><span class="linenos">214</span></a>    <span class="n">headers</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getheaders</span><span class="p">)</span>
</span><span id="WebSocket-215"><a href="#WebSocket-215"><span class="linenos">215</span></a>
</span><span id="WebSocket-216"><a href="#WebSocket-216"><span class="linenos">216</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="WebSocket-217"><a href="#WebSocket-217"><span class="linenos">217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-218"><a href="#WebSocket-218"><span class="linenos">218</span></a><span class="sd">        Connect to url. url is websocket url scheme.</span>
</span><span id="WebSocket-219"><a href="#WebSocket-219"><span class="linenos">219</span></a><span class="sd">        ie. ws://host:port/resource</span>
</span><span id="WebSocket-220"><a href="#WebSocket-220"><span class="linenos">220</span></a><span class="sd">        You can customize using &#39;options&#39;.</span>
</span><span id="WebSocket-221"><a href="#WebSocket-221"><span class="linenos">221</span></a><span class="sd">        If you set &quot;header&quot; list object, you can set your own custom header.</span>
</span><span id="WebSocket-222"><a href="#WebSocket-222"><span class="linenos">222</span></a>
</span><span id="WebSocket-223"><a href="#WebSocket-223"><span class="linenos">223</span></a><span class="sd">        &gt;&gt;&gt; ws = WebSocket()</span>
</span><span id="WebSocket-224"><a href="#WebSocket-224"><span class="linenos">224</span></a><span class="sd">        &gt;&gt;&gt; ws.connect(&quot;ws://echo.websocket.events&quot;,</span>
</span><span id="WebSocket-225"><a href="#WebSocket-225"><span class="linenos">225</span></a><span class="sd">                ...     header=[&quot;User-Agent: MyProgram&quot;,</span>
</span><span id="WebSocket-226"><a href="#WebSocket-226"><span class="linenos">226</span></a><span class="sd">                ...             &quot;x-custom: header&quot;])</span>
</span><span id="WebSocket-227"><a href="#WebSocket-227"><span class="linenos">227</span></a>
</span><span id="WebSocket-228"><a href="#WebSocket-228"><span class="linenos">228</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket-229"><a href="#WebSocket-229"><span class="linenos">229</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-230"><a href="#WebSocket-230"><span class="linenos">230</span></a><span class="sd">        header: list or dict</span>
</span><span id="WebSocket-231"><a href="#WebSocket-231"><span class="linenos">231</span></a><span class="sd">            Custom http header list or dict.</span>
</span><span id="WebSocket-232"><a href="#WebSocket-232"><span class="linenos">232</span></a><span class="sd">        cookie: str</span>
</span><span id="WebSocket-233"><a href="#WebSocket-233"><span class="linenos">233</span></a><span class="sd">            Cookie value.</span>
</span><span id="WebSocket-234"><a href="#WebSocket-234"><span class="linenos">234</span></a><span class="sd">        origin: str</span>
</span><span id="WebSocket-235"><a href="#WebSocket-235"><span class="linenos">235</span></a><span class="sd">            Custom origin url.</span>
</span><span id="WebSocket-236"><a href="#WebSocket-236"><span class="linenos">236</span></a><span class="sd">        connection: str</span>
</span><span id="WebSocket-237"><a href="#WebSocket-237"><span class="linenos">237</span></a><span class="sd">            Custom connection header value.</span>
</span><span id="WebSocket-238"><a href="#WebSocket-238"><span class="linenos">238</span></a><span class="sd">            Default value &quot;Upgrade&quot; set in _handshake.py</span>
</span><span id="WebSocket-239"><a href="#WebSocket-239"><span class="linenos">239</span></a><span class="sd">        suppress_origin: bool</span>
</span><span id="WebSocket-240"><a href="#WebSocket-240"><span class="linenos">240</span></a><span class="sd">            Suppress outputting origin header.</span>
</span><span id="WebSocket-241"><a href="#WebSocket-241"><span class="linenos">241</span></a><span class="sd">        host: str</span>
</span><span id="WebSocket-242"><a href="#WebSocket-242"><span class="linenos">242</span></a><span class="sd">            Custom host header string.</span>
</span><span id="WebSocket-243"><a href="#WebSocket-243"><span class="linenos">243</span></a><span class="sd">        timeout: int or float</span>
</span><span id="WebSocket-244"><a href="#WebSocket-244"><span class="linenos">244</span></a><span class="sd">            Socket timeout time. This value is an integer or float.</span>
</span><span id="WebSocket-245"><a href="#WebSocket-245"><span class="linenos">245</span></a><span class="sd">            If you set None for this value, it means &quot;use default_timeout value&quot;</span>
</span><span id="WebSocket-246"><a href="#WebSocket-246"><span class="linenos">246</span></a><span class="sd">        http_proxy_host: str</span>
</span><span id="WebSocket-247"><a href="#WebSocket-247"><span class="linenos">247</span></a><span class="sd">            HTTP proxy host name.</span>
</span><span id="WebSocket-248"><a href="#WebSocket-248"><span class="linenos">248</span></a><span class="sd">        http_proxy_port: str or int</span>
</span><span id="WebSocket-249"><a href="#WebSocket-249"><span class="linenos">249</span></a><span class="sd">            HTTP proxy port. Default is 80.</span>
</span><span id="WebSocket-250"><a href="#WebSocket-250"><span class="linenos">250</span></a><span class="sd">        http_no_proxy: list</span>
</span><span id="WebSocket-251"><a href="#WebSocket-251"><span class="linenos">251</span></a><span class="sd">            Whitelisted host names that don&#39;t use the proxy.</span>
</span><span id="WebSocket-252"><a href="#WebSocket-252"><span class="linenos">252</span></a><span class="sd">        http_proxy_auth: tuple</span>
</span><span id="WebSocket-253"><a href="#WebSocket-253"><span class="linenos">253</span></a><span class="sd">            HTTP proxy auth information. Tuple of username and password. Default is None.</span>
</span><span id="WebSocket-254"><a href="#WebSocket-254"><span class="linenos">254</span></a><span class="sd">        http_proxy_timeout: int or float</span>
</span><span id="WebSocket-255"><a href="#WebSocket-255"><span class="linenos">255</span></a><span class="sd">            HTTP proxy timeout, default is 60 sec as per python-socks.</span>
</span><span id="WebSocket-256"><a href="#WebSocket-256"><span class="linenos">256</span></a><span class="sd">        redirect_limit: int</span>
</span><span id="WebSocket-257"><a href="#WebSocket-257"><span class="linenos">257</span></a><span class="sd">            Number of redirects to follow.</span>
</span><span id="WebSocket-258"><a href="#WebSocket-258"><span class="linenos">258</span></a><span class="sd">        subprotocols: list</span>
</span><span id="WebSocket-259"><a href="#WebSocket-259"><span class="linenos">259</span></a><span class="sd">            List of available subprotocols. Default is None.</span>
</span><span id="WebSocket-260"><a href="#WebSocket-260"><span class="linenos">260</span></a><span class="sd">        socket: socket</span>
</span><span id="WebSocket-261"><a href="#WebSocket-261"><span class="linenos">261</span></a><span class="sd">            Pre-initialized stream socket.</span>
</span><span id="WebSocket-262"><a href="#WebSocket-262"><span class="linenos">262</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-263"><a href="#WebSocket-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="WebSocket-264"><a href="#WebSocket-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">addrs</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span>
</span><span id="WebSocket-265"><a href="#WebSocket-265"><span class="linenos">265</span></a>            <span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="p">,</span> <span class="n">proxy_info</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">),</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;socket&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="WebSocket-266"><a href="#WebSocket-266"><span class="linenos">266</span></a>        <span class="p">)</span>
</span><span id="WebSocket-267"><a href="#WebSocket-267"><span class="linenos">267</span></a>
</span><span id="WebSocket-268"><a href="#WebSocket-268"><span class="linenos">268</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="WebSocket-269"><a href="#WebSocket-269"><span class="linenos">269</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span> <span class="o">=</span> <span class="n">handshake</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">*</span><span class="n">addrs</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="WebSocket-270"><a href="#WebSocket-270"><span class="linenos">270</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;redirect_limit&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
</span><span id="WebSocket-271"><a href="#WebSocket-271"><span class="linenos">271</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="n">SUPPORTED_REDIRECT_STATUSES</span><span class="p">:</span>
</span><span id="WebSocket-272"><a href="#WebSocket-272"><span class="linenos">272</span></a>                    <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]</span>
</span><span id="WebSocket-273"><a href="#WebSocket-273"><span class="linenos">273</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="WebSocket-274"><a href="#WebSocket-274"><span class="linenos">274</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">addrs</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span>
</span><span id="WebSocket-275"><a href="#WebSocket-275"><span class="linenos">275</span></a>                        <span class="n">url</span><span class="p">,</span>
</span><span id="WebSocket-276"><a href="#WebSocket-276"><span class="linenos">276</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="p">,</span>
</span><span id="WebSocket-277"><a href="#WebSocket-277"><span class="linenos">277</span></a>                        <span class="n">proxy_info</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">),</span>
</span><span id="WebSocket-278"><a href="#WebSocket-278"><span class="linenos">278</span></a>                        <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;socket&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="WebSocket-279"><a href="#WebSocket-279"><span class="linenos">279</span></a>                    <span class="p">)</span>
</span><span id="WebSocket-280"><a href="#WebSocket-280"><span class="linenos">280</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span> <span class="o">=</span> <span class="n">handshake</span><span class="p">(</span>
</span><span id="WebSocket-281"><a href="#WebSocket-281"><span class="linenos">281</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">*</span><span class="n">addrs</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span>
</span><span id="WebSocket-282"><a href="#WebSocket-282"><span class="linenos">282</span></a>                    <span class="p">)</span>
</span><span id="WebSocket-283"><a href="#WebSocket-283"><span class="linenos">283</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="WebSocket-284"><a href="#WebSocket-284"><span class="linenos">284</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="WebSocket-285"><a href="#WebSocket-285"><span class="linenos">285</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span>
</span><span id="WebSocket-286"><a href="#WebSocket-286"><span class="linenos">286</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="WebSocket-287"><a href="#WebSocket-287"><span class="linenos">287</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WebSocket-288"><a href="#WebSocket-288"><span class="linenos">288</span></a>            <span class="k">raise</span>
</span><span id="WebSocket-289"><a href="#WebSocket-289"><span class="linenos">289</span></a>
</span><span id="WebSocket-290"><a href="#WebSocket-290"><span class="linenos">290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">opcode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_TEXT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="WebSocket-291"><a href="#WebSocket-291"><span class="linenos">291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-292"><a href="#WebSocket-292"><span class="linenos">292</span></a><span class="sd">        Send the data as string.</span>
</span><span id="WebSocket-293"><a href="#WebSocket-293"><span class="linenos">293</span></a>
</span><span id="WebSocket-294"><a href="#WebSocket-294"><span class="linenos">294</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket-295"><a href="#WebSocket-295"><span class="linenos">295</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-296"><a href="#WebSocket-296"><span class="linenos">296</span></a><span class="sd">        payload: str</span>
</span><span id="WebSocket-297"><a href="#WebSocket-297"><span class="linenos">297</span></a><span class="sd">            Payload must be utf-8 string or unicode,</span>
</span><span id="WebSocket-298"><a href="#WebSocket-298"><span class="linenos">298</span></a><span class="sd">            If the opcode is OPCODE_TEXT.</span>
</span><span id="WebSocket-299"><a href="#WebSocket-299"><span class="linenos">299</span></a><span class="sd">            Otherwise, it must be string(byte array).</span>
</span><span id="WebSocket-300"><a href="#WebSocket-300"><span class="linenos">300</span></a><span class="sd">        opcode: int</span>
</span><span id="WebSocket-301"><a href="#WebSocket-301"><span class="linenos">301</span></a><span class="sd">            Operation code (opcode) to send.</span>
</span><span id="WebSocket-302"><a href="#WebSocket-302"><span class="linenos">302</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-303"><a href="#WebSocket-303"><span class="linenos">303</span></a>
</span><span id="WebSocket-304"><a href="#WebSocket-304"><span class="linenos">304</span></a>        <span class="n">frame</span> <span class="o">=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">create_frame</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">opcode</span><span class="p">)</span>
</span><span id="WebSocket-305"><a href="#WebSocket-305"><span class="linenos">305</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="WebSocket-306"><a href="#WebSocket-306"><span class="linenos">306</span></a>
</span><span id="WebSocket-307"><a href="#WebSocket-307"><span class="linenos">307</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="WebSocket-308"><a href="#WebSocket-308"><span class="linenos">308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-309"><a href="#WebSocket-309"><span class="linenos">309</span></a><span class="sd">        Sends UTF-8 encoded text.</span>
</span><span id="WebSocket-310"><a href="#WebSocket-310"><span class="linenos">310</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-311"><a href="#WebSocket-311"><span class="linenos">311</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">text_data</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_TEXT</span><span class="p">)</span>
</span><span id="WebSocket-312"><a href="#WebSocket-312"><span class="linenos">312</span></a>
</span><span id="WebSocket-313"><a href="#WebSocket-313"><span class="linenos">313</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="WebSocket-314"><a href="#WebSocket-314"><span class="linenos">314</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-315"><a href="#WebSocket-315"><span class="linenos">315</span></a><span class="sd">        Sends a sequence of bytes.</span>
</span><span id="WebSocket-316"><a href="#WebSocket-316"><span class="linenos">316</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-317"><a href="#WebSocket-317"><span class="linenos">317</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_BINARY</span><span class="p">)</span>
</span><span id="WebSocket-318"><a href="#WebSocket-318"><span class="linenos">318</span></a>
</span><span id="WebSocket-319"><a href="#WebSocket-319"><span class="linenos">319</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="WebSocket-320"><a href="#WebSocket-320"><span class="linenos">320</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-321"><a href="#WebSocket-321"><span class="linenos">321</span></a><span class="sd">        Send the data frame.</span>
</span><span id="WebSocket-322"><a href="#WebSocket-322"><span class="linenos">322</span></a>
</span><span id="WebSocket-323"><a href="#WebSocket-323"><span class="linenos">323</span></a><span class="sd">        &gt;&gt;&gt; ws = create_connection(&quot;ws://echo.websocket.events&quot;)</span>
</span><span id="WebSocket-324"><a href="#WebSocket-324"><span class="linenos">324</span></a><span class="sd">        &gt;&gt;&gt; frame = ABNF.create_frame(&quot;Hello&quot;, ABNF.OPCODE_TEXT)</span>
</span><span id="WebSocket-325"><a href="#WebSocket-325"><span class="linenos">325</span></a><span class="sd">        &gt;&gt;&gt; ws.send_frame(frame)</span>
</span><span id="WebSocket-326"><a href="#WebSocket-326"><span class="linenos">326</span></a><span class="sd">        &gt;&gt;&gt; cont_frame = ABNF.create_frame(&quot;My name is &quot;, ABNF.OPCODE_CONT, 0)</span>
</span><span id="WebSocket-327"><a href="#WebSocket-327"><span class="linenos">327</span></a><span class="sd">        &gt;&gt;&gt; ws.send_frame(frame)</span>
</span><span id="WebSocket-328"><a href="#WebSocket-328"><span class="linenos">328</span></a><span class="sd">        &gt;&gt;&gt; cont_frame = ABNF.create_frame(&quot;Foo Bar&quot;, ABNF.OPCODE_CONT, 1)</span>
</span><span id="WebSocket-329"><a href="#WebSocket-329"><span class="linenos">329</span></a><span class="sd">        &gt;&gt;&gt; ws.send_frame(frame)</span>
</span><span id="WebSocket-330"><a href="#WebSocket-330"><span class="linenos">330</span></a>
</span><span id="WebSocket-331"><a href="#WebSocket-331"><span class="linenos">331</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket-332"><a href="#WebSocket-332"><span class="linenos">332</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-333"><a href="#WebSocket-333"><span class="linenos">333</span></a><span class="sd">        frame: ABNF frame</span>
</span><span id="WebSocket-334"><a href="#WebSocket-334"><span class="linenos">334</span></a><span class="sd">            frame data created by ABNF.create_frame</span>
</span><span id="WebSocket-335"><a href="#WebSocket-335"><span class="linenos">335</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-336"><a href="#WebSocket-336"><span class="linenos">336</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mask_key</span><span class="p">:</span>
</span><span id="WebSocket-337"><a href="#WebSocket-337"><span class="linenos">337</span></a>            <span class="n">frame</span><span class="o">.</span><span class="n">get_mask_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mask_key</span>
</span><span id="WebSocket-338"><a href="#WebSocket-338"><span class="linenos">338</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
</span><span id="WebSocket-339"><a href="#WebSocket-339"><span class="linenos">339</span></a>        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="WebSocket-340"><a href="#WebSocket-340"><span class="linenos">340</span></a>        <span class="k">if</span> <span class="n">isEnabledForTrace</span><span class="p">():</span>
</span><span id="WebSocket-341"><a href="#WebSocket-341"><span class="linenos">341</span></a>            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;++Sent raw: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WebSocket-342"><a href="#WebSocket-342"><span class="linenos">342</span></a>            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;++Sent decoded: </span><span class="si">{</span><span class="n">frame</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WebSocket-343"><a href="#WebSocket-343"><span class="linenos">343</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span><span id="WebSocket-344"><a href="#WebSocket-344"><span class="linenos">344</span></a>            <span class="k">while</span> <span class="n">data</span><span class="p">:</span>
</span><span id="WebSocket-345"><a href="#WebSocket-345"><span class="linenos">345</span></a>                <span class="n">bytes_sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="WebSocket-346"><a href="#WebSocket-346"><span class="linenos">346</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">bytes_sent</span><span class="p">:]</span>
</span><span id="WebSocket-347"><a href="#WebSocket-347"><span class="linenos">347</span></a>
</span><span id="WebSocket-348"><a href="#WebSocket-348"><span class="linenos">348</span></a>        <span class="k">return</span> <span class="n">length</span>
</span><span id="WebSocket-349"><a href="#WebSocket-349"><span class="linenos">349</span></a>
</span><span id="WebSocket-350"><a href="#WebSocket-350"><span class="linenos">350</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="WebSocket-351"><a href="#WebSocket-351"><span class="linenos">351</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-352"><a href="#WebSocket-352"><span class="linenos">352</span></a><span class="sd">        Send a binary message (OPCODE_BINARY).</span>
</span><span id="WebSocket-353"><a href="#WebSocket-353"><span class="linenos">353</span></a>
</span><span id="WebSocket-354"><a href="#WebSocket-354"><span class="linenos">354</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket-355"><a href="#WebSocket-355"><span class="linenos">355</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-356"><a href="#WebSocket-356"><span class="linenos">356</span></a><span class="sd">        payload: bytes</span>
</span><span id="WebSocket-357"><a href="#WebSocket-357"><span class="linenos">357</span></a><span class="sd">            payload of message to send.</span>
</span><span id="WebSocket-358"><a href="#WebSocket-358"><span class="linenos">358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-359"><a href="#WebSocket-359"><span class="linenos">359</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_BINARY</span><span class="p">)</span>
</span><span id="WebSocket-360"><a href="#WebSocket-360"><span class="linenos">360</span></a>
</span><span id="WebSocket-361"><a href="#WebSocket-361"><span class="linenos">361</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="WebSocket-362"><a href="#WebSocket-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-363"><a href="#WebSocket-363"><span class="linenos">363</span></a><span class="sd">        Send ping data.</span>
</span><span id="WebSocket-364"><a href="#WebSocket-364"><span class="linenos">364</span></a>
</span><span id="WebSocket-365"><a href="#WebSocket-365"><span class="linenos">365</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket-366"><a href="#WebSocket-366"><span class="linenos">366</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-367"><a href="#WebSocket-367"><span class="linenos">367</span></a><span class="sd">        payload: str</span>
</span><span id="WebSocket-368"><a href="#WebSocket-368"><span class="linenos">368</span></a><span class="sd">            data payload to send server.</span>
</span><span id="WebSocket-369"><a href="#WebSocket-369"><span class="linenos">369</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-370"><a href="#WebSocket-370"><span class="linenos">370</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="WebSocket-371"><a href="#WebSocket-371"><span class="linenos">371</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="WebSocket-372"><a href="#WebSocket-372"><span class="linenos">372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_PING</span><span class="p">)</span>
</span><span id="WebSocket-373"><a href="#WebSocket-373"><span class="linenos">373</span></a>
</span><span id="WebSocket-374"><a href="#WebSocket-374"><span class="linenos">374</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">pong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="WebSocket-375"><a href="#WebSocket-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-376"><a href="#WebSocket-376"><span class="linenos">376</span></a><span class="sd">        Send pong data.</span>
</span><span id="WebSocket-377"><a href="#WebSocket-377"><span class="linenos">377</span></a>
</span><span id="WebSocket-378"><a href="#WebSocket-378"><span class="linenos">378</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket-379"><a href="#WebSocket-379"><span class="linenos">379</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-380"><a href="#WebSocket-380"><span class="linenos">380</span></a><span class="sd">        payload: str</span>
</span><span id="WebSocket-381"><a href="#WebSocket-381"><span class="linenos">381</span></a><span class="sd">            data payload to send server.</span>
</span><span id="WebSocket-382"><a href="#WebSocket-382"><span class="linenos">382</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-383"><a href="#WebSocket-383"><span class="linenos">383</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="WebSocket-384"><a href="#WebSocket-384"><span class="linenos">384</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="WebSocket-385"><a href="#WebSocket-385"><span class="linenos">385</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_PONG</span><span class="p">)</span>
</span><span id="WebSocket-386"><a href="#WebSocket-386"><span class="linenos">386</span></a>
</span><span id="WebSocket-387"><a href="#WebSocket-387"><span class="linenos">387</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recv</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
</span><span id="WebSocket-388"><a href="#WebSocket-388"><span class="linenos">388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-389"><a href="#WebSocket-389"><span class="linenos">389</span></a><span class="sd">        Receive string data(byte array) from the server.</span>
</span><span id="WebSocket-390"><a href="#WebSocket-390"><span class="linenos">390</span></a>
</span><span id="WebSocket-391"><a href="#WebSocket-391"><span class="linenos">391</span></a><span class="sd">        Returns</span>
</span><span id="WebSocket-392"><a href="#WebSocket-392"><span class="linenos">392</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-393"><a href="#WebSocket-393"><span class="linenos">393</span></a><span class="sd">        data: string (byte array) value.</span>
</span><span id="WebSocket-394"><a href="#WebSocket-394"><span class="linenos">394</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-395"><a href="#WebSocket-395"><span class="linenos">395</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">readlock</span><span class="p">:</span>
</span><span id="WebSocket-396"><a href="#WebSocket-396"><span class="linenos">396</span></a>            <span class="n">opcode</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_data</span><span class="p">()</span>
</span><span id="WebSocket-397"><a href="#WebSocket-397"><span class="linenos">397</span></a>        <span class="k">if</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_TEXT</span><span class="p">:</span>
</span><span id="WebSocket-398"><a href="#WebSocket-398"><span class="linenos">398</span></a>            <span class="n">data_received</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="WebSocket-399"><a href="#WebSocket-399"><span class="linenos">399</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_received</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="WebSocket-400"><a href="#WebSocket-400"><span class="linenos">400</span></a>                <span class="k">return</span> <span class="n">data_received</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="WebSocket-401"><a href="#WebSocket-401"><span class="linenos">401</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_received</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="WebSocket-402"><a href="#WebSocket-402"><span class="linenos">402</span></a>                <span class="k">return</span> <span class="n">data_received</span>
</span><span id="WebSocket-403"><a href="#WebSocket-403"><span class="linenos">403</span></a>        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_BINARY</span><span class="p">:</span>
</span><span id="WebSocket-404"><a href="#WebSocket-404"><span class="linenos">404</span></a>            <span class="n">data_binary</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="WebSocket-405"><a href="#WebSocket-405"><span class="linenos">405</span></a>            <span class="k">return</span> <span class="n">data_binary</span>
</span><span id="WebSocket-406"><a href="#WebSocket-406"><span class="linenos">406</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket-407"><a href="#WebSocket-407"><span class="linenos">407</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="WebSocket-408"><a href="#WebSocket-408"><span class="linenos">408</span></a>
</span><span id="WebSocket-409"><a href="#WebSocket-409"><span class="linenos">409</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recv_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_frame</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="WebSocket-410"><a href="#WebSocket-410"><span class="linenos">410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-411"><a href="#WebSocket-411"><span class="linenos">411</span></a><span class="sd">        Receive data with operation code.</span>
</span><span id="WebSocket-412"><a href="#WebSocket-412"><span class="linenos">412</span></a>
</span><span id="WebSocket-413"><a href="#WebSocket-413"><span class="linenos">413</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket-414"><a href="#WebSocket-414"><span class="linenos">414</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-415"><a href="#WebSocket-415"><span class="linenos">415</span></a><span class="sd">        control_frame: bool</span>
</span><span id="WebSocket-416"><a href="#WebSocket-416"><span class="linenos">416</span></a><span class="sd">            a boolean flag indicating whether to return control frame</span>
</span><span id="WebSocket-417"><a href="#WebSocket-417"><span class="linenos">417</span></a><span class="sd">            data, defaults to False</span>
</span><span id="WebSocket-418"><a href="#WebSocket-418"><span class="linenos">418</span></a>
</span><span id="WebSocket-419"><a href="#WebSocket-419"><span class="linenos">419</span></a><span class="sd">        Returns</span>
</span><span id="WebSocket-420"><a href="#WebSocket-420"><span class="linenos">420</span></a><span class="sd">        -------</span>
</span><span id="WebSocket-421"><a href="#WebSocket-421"><span class="linenos">421</span></a><span class="sd">        opcode, frame.data: tuple</span>
</span><span id="WebSocket-422"><a href="#WebSocket-422"><span class="linenos">422</span></a><span class="sd">            tuple of operation code and string(byte array) value.</span>
</span><span id="WebSocket-423"><a href="#WebSocket-423"><span class="linenos">423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-424"><a href="#WebSocket-424"><span class="linenos">424</span></a>        <span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_data_frame</span><span class="p">(</span><span class="n">control_frame</span><span class="p">)</span>
</span><span id="WebSocket-425"><a href="#WebSocket-425"><span class="linenos">425</span></a>        <span class="k">return</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">data</span>
</span><span id="WebSocket-426"><a href="#WebSocket-426"><span class="linenos">426</span></a>
</span><span id="WebSocket-427"><a href="#WebSocket-427"><span class="linenos">427</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recv_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_frame</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="WebSocket-428"><a href="#WebSocket-428"><span class="linenos">428</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-429"><a href="#WebSocket-429"><span class="linenos">429</span></a><span class="sd">        Receive data with operation code.</span>
</span><span id="WebSocket-430"><a href="#WebSocket-430"><span class="linenos">430</span></a>
</span><span id="WebSocket-431"><a href="#WebSocket-431"><span class="linenos">431</span></a><span class="sd">        If a valid ping message is received, a pong response is sent.</span>
</span><span id="WebSocket-432"><a href="#WebSocket-432"><span class="linenos">432</span></a>
</span><span id="WebSocket-433"><a href="#WebSocket-433"><span class="linenos">433</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket-434"><a href="#WebSocket-434"><span class="linenos">434</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-435"><a href="#WebSocket-435"><span class="linenos">435</span></a><span class="sd">        control_frame: bool</span>
</span><span id="WebSocket-436"><a href="#WebSocket-436"><span class="linenos">436</span></a><span class="sd">            a boolean flag indicating whether to return control frame</span>
</span><span id="WebSocket-437"><a href="#WebSocket-437"><span class="linenos">437</span></a><span class="sd">            data, defaults to False</span>
</span><span id="WebSocket-438"><a href="#WebSocket-438"><span class="linenos">438</span></a>
</span><span id="WebSocket-439"><a href="#WebSocket-439"><span class="linenos">439</span></a><span class="sd">        Returns</span>
</span><span id="WebSocket-440"><a href="#WebSocket-440"><span class="linenos">440</span></a><span class="sd">        -------</span>
</span><span id="WebSocket-441"><a href="#WebSocket-441"><span class="linenos">441</span></a><span class="sd">        frame.opcode, frame: tuple</span>
</span><span id="WebSocket-442"><a href="#WebSocket-442"><span class="linenos">442</span></a><span class="sd">            tuple of operation code and string(byte array) value.</span>
</span><span id="WebSocket-443"><a href="#WebSocket-443"><span class="linenos">443</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-444"><a href="#WebSocket-444"><span class="linenos">444</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="WebSocket-445"><a href="#WebSocket-445"><span class="linenos">445</span></a>            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_frame</span><span class="p">()</span>
</span><span id="WebSocket-446"><a href="#WebSocket-446"><span class="linenos">446</span></a>            <span class="k">if</span> <span class="n">isEnabledForTrace</span><span class="p">():</span>
</span><span id="WebSocket-447"><a href="#WebSocket-447"><span class="linenos">447</span></a>                <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;++Rcv raw: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">format</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WebSocket-448"><a href="#WebSocket-448"><span class="linenos">448</span></a>                <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;++Rcv decoded: </span><span class="si">{</span><span class="n">frame</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WebSocket-449"><a href="#WebSocket-449"><span class="linenos">449</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">frame</span><span class="p">:</span>
</span><span id="WebSocket-450"><a href="#WebSocket-450"><span class="linenos">450</span></a>                <span class="c1"># handle error:</span>
</span><span id="WebSocket-451"><a href="#WebSocket-451"><span class="linenos">451</span></a>                <span class="c1"># &#39;NoneType&#39; object has no attribute &#39;opcode&#39;</span>
</span><span id="WebSocket-452"><a href="#WebSocket-452"><span class="linenos">452</span></a>                <span class="k">raise</span> <span class="n">WebSocketProtocolException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not a valid frame </span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WebSocket-453"><a href="#WebSocket-453"><span class="linenos">453</span></a>            <span class="k">elif</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="ow">in</span> <span class="p">(</span>
</span><span id="WebSocket-454"><a href="#WebSocket-454"><span class="linenos">454</span></a>                <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_TEXT</span><span class="p">,</span>
</span><span id="WebSocket-455"><a href="#WebSocket-455"><span class="linenos">455</span></a>                <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_BINARY</span><span class="p">,</span>
</span><span id="WebSocket-456"><a href="#WebSocket-456"><span class="linenos">456</span></a>                <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CONT</span><span class="p">,</span>
</span><span id="WebSocket-457"><a href="#WebSocket-457"><span class="linenos">457</span></a>            <span class="p">):</span>
</span><span id="WebSocket-458"><a href="#WebSocket-458"><span class="linenos">458</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="WebSocket-459"><a href="#WebSocket-459"><span class="linenos">459</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="WebSocket-460"><a href="#WebSocket-460"><span class="linenos">460</span></a>
</span><span id="WebSocket-461"><a href="#WebSocket-461"><span class="linenos">461</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span><span class="o">.</span><span class="n">is_fire</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
</span><span id="WebSocket-462"><a href="#WebSocket-462"><span class="linenos">462</span></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="WebSocket-463"><a href="#WebSocket-463"><span class="linenos">463</span></a>
</span><span id="WebSocket-464"><a href="#WebSocket-464"><span class="linenos">464</span></a>            <span class="k">elif</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CLOSE</span><span class="p">:</span>
</span><span id="WebSocket-465"><a href="#WebSocket-465"><span class="linenos">465</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">send_close</span><span class="p">()</span>
</span><span id="WebSocket-466"><a href="#WebSocket-466"><span class="linenos">466</span></a>                <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span>
</span><span id="WebSocket-467"><a href="#WebSocket-467"><span class="linenos">467</span></a>            <span class="k">elif</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_PING</span><span class="p">:</span>
</span><span id="WebSocket-468"><a href="#WebSocket-468"><span class="linenos">468</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">126</span><span class="p">:</span>
</span><span id="WebSocket-469"><a href="#WebSocket-469"><span class="linenos">469</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pong</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="WebSocket-470"><a href="#WebSocket-470"><span class="linenos">470</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket-471"><a href="#WebSocket-471"><span class="linenos">471</span></a>                    <span class="k">raise</span> <span class="n">WebSocketProtocolException</span><span class="p">(</span><span class="s2">&quot;Ping message is too long&quot;</span><span class="p">)</span>
</span><span id="WebSocket-472"><a href="#WebSocket-472"><span class="linenos">472</span></a>                <span class="k">if</span> <span class="n">control_frame</span><span class="p">:</span>
</span><span id="WebSocket-473"><a href="#WebSocket-473"><span class="linenos">473</span></a>                    <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span>
</span><span id="WebSocket-474"><a href="#WebSocket-474"><span class="linenos">474</span></a>            <span class="k">elif</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_PONG</span><span class="p">:</span>
</span><span id="WebSocket-475"><a href="#WebSocket-475"><span class="linenos">475</span></a>                <span class="k">if</span> <span class="n">control_frame</span><span class="p">:</span>
</span><span id="WebSocket-476"><a href="#WebSocket-476"><span class="linenos">476</span></a>                    <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span>
</span><span id="WebSocket-477"><a href="#WebSocket-477"><span class="linenos">477</span></a>
</span><span id="WebSocket-478"><a href="#WebSocket-478"><span class="linenos">478</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recv_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket-479"><a href="#WebSocket-479"><span class="linenos">479</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-480"><a href="#WebSocket-480"><span class="linenos">480</span></a><span class="sd">        Receive data as frame from server.</span>
</span><span id="WebSocket-481"><a href="#WebSocket-481"><span class="linenos">481</span></a>
</span><span id="WebSocket-482"><a href="#WebSocket-482"><span class="linenos">482</span></a><span class="sd">        Returns</span>
</span><span id="WebSocket-483"><a href="#WebSocket-483"><span class="linenos">483</span></a><span class="sd">        -------</span>
</span><span id="WebSocket-484"><a href="#WebSocket-484"><span class="linenos">484</span></a><span class="sd">        self.frame_buffer.recv_frame(): ABNF frame object</span>
</span><span id="WebSocket-485"><a href="#WebSocket-485"><span class="linenos">485</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-486"><a href="#WebSocket-486"><span class="linenos">486</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_buffer</span><span class="o">.</span><span class="n">recv_frame</span><span class="p">()</span>
</span><span id="WebSocket-487"><a href="#WebSocket-487"><span class="linenos">487</span></a>
</span><span id="WebSocket-488"><a href="#WebSocket-488"><span class="linenos">488</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">STATUS_NORMAL</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="WebSocket-489"><a href="#WebSocket-489"><span class="linenos">489</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-490"><a href="#WebSocket-490"><span class="linenos">490</span></a><span class="sd">        Send close data to the server.</span>
</span><span id="WebSocket-491"><a href="#WebSocket-491"><span class="linenos">491</span></a>
</span><span id="WebSocket-492"><a href="#WebSocket-492"><span class="linenos">492</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket-493"><a href="#WebSocket-493"><span class="linenos">493</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-494"><a href="#WebSocket-494"><span class="linenos">494</span></a><span class="sd">        status: int</span>
</span><span id="WebSocket-495"><a href="#WebSocket-495"><span class="linenos">495</span></a><span class="sd">            Status code to send. See STATUS_XXX.</span>
</span><span id="WebSocket-496"><a href="#WebSocket-496"><span class="linenos">496</span></a><span class="sd">        reason: str or bytes</span>
</span><span id="WebSocket-497"><a href="#WebSocket-497"><span class="linenos">497</span></a><span class="sd">            The reason to close. This must be string or UTF-8 bytes.</span>
</span><span id="WebSocket-498"><a href="#WebSocket-498"><span class="linenos">498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-499"><a href="#WebSocket-499"><span class="linenos">499</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">&gt;=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">LENGTH_16</span><span class="p">:</span>
</span><span id="WebSocket-500"><a href="#WebSocket-500"><span class="linenos">500</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;code is invalid range&quot;</span><span class="p">)</span>
</span><span id="WebSocket-501"><a href="#WebSocket-501"><span class="linenos">501</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="WebSocket-502"><a href="#WebSocket-502"><span class="linenos">502</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;!H&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span> <span class="o">+</span> <span class="n">reason</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CLOSE</span><span class="p">)</span>
</span><span id="WebSocket-503"><a href="#WebSocket-503"><span class="linenos">503</span></a>
</span><span id="WebSocket-504"><a href="#WebSocket-504"><span class="linenos">504</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">STATUS_NORMAL</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
</span><span id="WebSocket-505"><a href="#WebSocket-505"><span class="linenos">505</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-506"><a href="#WebSocket-506"><span class="linenos">506</span></a><span class="sd">        Close Websocket object</span>
</span><span id="WebSocket-507"><a href="#WebSocket-507"><span class="linenos">507</span></a>
</span><span id="WebSocket-508"><a href="#WebSocket-508"><span class="linenos">508</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket-509"><a href="#WebSocket-509"><span class="linenos">509</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket-510"><a href="#WebSocket-510"><span class="linenos">510</span></a><span class="sd">        status: int</span>
</span><span id="WebSocket-511"><a href="#WebSocket-511"><span class="linenos">511</span></a><span class="sd">            Status code to send. See VALID_CLOSE_STATUS in ABNF.</span>
</span><span id="WebSocket-512"><a href="#WebSocket-512"><span class="linenos">512</span></a><span class="sd">        reason: bytes</span>
</span><span id="WebSocket-513"><a href="#WebSocket-513"><span class="linenos">513</span></a><span class="sd">            The reason to close in UTF-8.</span>
</span><span id="WebSocket-514"><a href="#WebSocket-514"><span class="linenos">514</span></a><span class="sd">        timeout: int or float</span>
</span><span id="WebSocket-515"><a href="#WebSocket-515"><span class="linenos">515</span></a><span class="sd">            Timeout until receive a close frame.</span>
</span><span id="WebSocket-516"><a href="#WebSocket-516"><span class="linenos">516</span></a><span class="sd">            If None, it will wait forever until receive a close frame.</span>
</span><span id="WebSocket-517"><a href="#WebSocket-517"><span class="linenos">517</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-518"><a href="#WebSocket-518"><span class="linenos">518</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="WebSocket-519"><a href="#WebSocket-519"><span class="linenos">519</span></a>            <span class="k">return</span>
</span><span id="WebSocket-520"><a href="#WebSocket-520"><span class="linenos">520</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">&gt;=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">LENGTH_16</span><span class="p">:</span>
</span><span id="WebSocket-521"><a href="#WebSocket-521"><span class="linenos">521</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;code is invalid range&quot;</span><span class="p">)</span>
</span><span id="WebSocket-522"><a href="#WebSocket-522"><span class="linenos">522</span></a>
</span><span id="WebSocket-523"><a href="#WebSocket-523"><span class="linenos">523</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="WebSocket-524"><a href="#WebSocket-524"><span class="linenos">524</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="WebSocket-525"><a href="#WebSocket-525"><span class="linenos">525</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;!H&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span> <span class="o">+</span> <span class="n">reason</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CLOSE</span><span class="p">)</span>
</span><span id="WebSocket-526"><a href="#WebSocket-526"><span class="linenos">526</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WebSocket-527"><a href="#WebSocket-527"><span class="linenos">527</span></a>                <span class="k">return</span>
</span><span id="WebSocket-528"><a href="#WebSocket-528"><span class="linenos">528</span></a>            <span class="n">sock_timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">gettimeout</span><span class="p">()</span>
</span><span id="WebSocket-529"><a href="#WebSocket-529"><span class="linenos">529</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="WebSocket-530"><a href="#WebSocket-530"><span class="linenos">530</span></a>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="WebSocket-531"><a href="#WebSocket-531"><span class="linenos">531</span></a>            <span class="k">while</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="WebSocket-532"><a href="#WebSocket-532"><span class="linenos">532</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="WebSocket-533"><a href="#WebSocket-533"><span class="linenos">533</span></a>                    <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_frame</span><span class="p">()</span>
</span><span id="WebSocket-534"><a href="#WebSocket-534"><span class="linenos">534</span></a>                    <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="o">!=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CLOSE</span><span class="p">:</span>
</span><span id="WebSocket-535"><a href="#WebSocket-535"><span class="linenos">535</span></a>                        <span class="k">continue</span>
</span><span id="WebSocket-536"><a href="#WebSocket-536"><span class="linenos">536</span></a>                    <span class="k">if</span> <span class="n">isEnabledForError</span><span class="p">():</span>
</span><span id="WebSocket-537"><a href="#WebSocket-537"><span class="linenos">537</span></a>                        <span class="n">recv_status</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;!H&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WebSocket-538"><a href="#WebSocket-538"><span class="linenos">538</span></a>                        <span class="k">if</span> <span class="n">recv_status</span> <span class="o">&gt;=</span> <span class="mi">3000</span> <span class="ow">and</span> <span class="n">recv_status</span> <span class="o">&lt;=</span> <span class="mi">4999</span><span class="p">:</span>
</span><span id="WebSocket-539"><a href="#WebSocket-539"><span class="linenos">539</span></a>                            <span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;close status: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">recv_status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WebSocket-540"><a href="#WebSocket-540"><span class="linenos">540</span></a>                        <span class="k">elif</span> <span class="n">recv_status</span> <span class="o">!=</span> <span class="n">STATUS_NORMAL</span><span class="p">:</span>
</span><span id="WebSocket-541"><a href="#WebSocket-541"><span class="linenos">541</span></a>                            <span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;close status: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">recv_status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WebSocket-542"><a href="#WebSocket-542"><span class="linenos">542</span></a>                    <span class="k">break</span>
</span><span id="WebSocket-543"><a href="#WebSocket-543"><span class="linenos">543</span></a>                <span class="k">except</span> <span class="p">(</span>
</span><span id="WebSocket-544"><a href="#WebSocket-544"><span class="linenos">544</span></a>                    <span class="n">WebSocketConnectionClosedException</span><span class="p">,</span>
</span><span id="WebSocket-545"><a href="#WebSocket-545"><span class="linenos">545</span></a>                    <span class="n">WebSocketTimeoutException</span><span class="p">,</span>
</span><span id="WebSocket-546"><a href="#WebSocket-546"><span class="linenos">546</span></a>                    <span class="n">struct</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
</span><span id="WebSocket-547"><a href="#WebSocket-547"><span class="linenos">547</span></a>                <span class="p">):</span>
</span><span id="WebSocket-548"><a href="#WebSocket-548"><span class="linenos">548</span></a>                    <span class="k">break</span>
</span><span id="WebSocket-549"><a href="#WebSocket-549"><span class="linenos">549</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WebSocket-550"><a href="#WebSocket-550"><span class="linenos">550</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">sock_timeout</span><span class="p">)</span>
</span><span id="WebSocket-551"><a href="#WebSocket-551"><span class="linenos">551</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_RDWR</span><span class="p">)</span>
</span><span id="WebSocket-552"><a href="#WebSocket-552"><span class="linenos">552</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="WebSocket-553"><a href="#WebSocket-553"><span class="linenos">553</span></a>            <span class="k">pass</span>
</span><span id="WebSocket-554"><a href="#WebSocket-554"><span class="linenos">554</span></a>
</span><span id="WebSocket-555"><a href="#WebSocket-555"><span class="linenos">555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="WebSocket-556"><a href="#WebSocket-556"><span class="linenos">556</span></a>
</span><span id="WebSocket-557"><a href="#WebSocket-557"><span class="linenos">557</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket-558"><a href="#WebSocket-558"><span class="linenos">558</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-559"><a href="#WebSocket-559"><span class="linenos">559</span></a><span class="sd">        Low-level asynchronous abort, wakes up other threads that are waiting in recv_*</span>
</span><span id="WebSocket-560"><a href="#WebSocket-560"><span class="linenos">560</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-561"><a href="#WebSocket-561"><span class="linenos">561</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="WebSocket-562"><a href="#WebSocket-562"><span class="linenos">562</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_RDWR</span><span class="p">)</span>
</span><span id="WebSocket-563"><a href="#WebSocket-563"><span class="linenos">563</span></a>
</span><span id="WebSocket-564"><a href="#WebSocket-564"><span class="linenos">564</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket-565"><a href="#WebSocket-565"><span class="linenos">565</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket-566"><a href="#WebSocket-566"><span class="linenos">566</span></a><span class="sd">        close socket, immediately.</span>
</span><span id="WebSocket-567"><a href="#WebSocket-567"><span class="linenos">567</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket-568"><a href="#WebSocket-568"><span class="linenos">568</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span>
</span><span id="WebSocket-569"><a href="#WebSocket-569"><span class="linenos">569</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="WebSocket-570"><a href="#WebSocket-570"><span class="linenos">570</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WebSocket-571"><a href="#WebSocket-571"><span class="linenos">571</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="WebSocket-572"><a href="#WebSocket-572"><span class="linenos">572</span></a>
</span><span id="WebSocket-573"><a href="#WebSocket-573"><span class="linenos">573</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]):</span>
</span><span id="WebSocket-574"><a href="#WebSocket-574"><span class="linenos">574</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WebSocket-575"><a href="#WebSocket-575"><span class="linenos">575</span></a>            <span class="k">raise</span> <span class="n">WebSocketConnectionClosedException</span><span class="p">(</span><span class="s2">&quot;socket is already closed.&quot;</span><span class="p">)</span>
</span><span id="WebSocket-576"><a href="#WebSocket-576"><span class="linenos">576</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatcher</span><span class="p">:</span>
</span><span id="WebSocket-577"><a href="#WebSocket-577"><span class="linenos">577</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatcher</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="WebSocket-578"><a href="#WebSocket-578"><span class="linenos">578</span></a>        <span class="k">return</span> <span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="WebSocket-579"><a href="#WebSocket-579"><span class="linenos">579</span></a>
</span><span id="WebSocket-580"><a href="#WebSocket-580"><span class="linenos">580</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_recv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">):</span>
</span><span id="WebSocket-581"><a href="#WebSocket-581"><span class="linenos">581</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="WebSocket-582"><a href="#WebSocket-582"><span class="linenos">582</span></a>            <span class="k">return</span> <span class="n">recv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">)</span>
</span><span id="WebSocket-583"><a href="#WebSocket-583"><span class="linenos">583</span></a>        <span class="k">except</span> <span class="n">WebSocketConnectionClosedException</span><span class="p">:</span>
</span><span id="WebSocket-584"><a href="#WebSocket-584"><span class="linenos">584</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span>
</span><span id="WebSocket-585"><a href="#WebSocket-585"><span class="linenos">585</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="WebSocket-586"><a href="#WebSocket-586"><span class="linenos">586</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WebSocket-587"><a href="#WebSocket-587"><span class="linenos">587</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="WebSocket-588"><a href="#WebSocket-588"><span class="linenos">588</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Low level WebSocket interface.</p>

<p>This class is based on the WebSocket protocol <a href="http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol-76">draft-hixie-thewebsocketprotocol-76 </a></p>

<p>We can connect to the websocket server and send/receive data.
The following example is an echo client.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">websocket</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="o">.</span><span class="n">WebSocket</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;ws://echo.websocket.events&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="go">&#39;echo.websocket.events sponsored by Lob.com&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Hello, Server&quot;</span><span class="p">)</span>
<span class="go">19</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="go">&#39;Hello, Server&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
</div>

<h2 id="parameters">Parameters</h2>

<p>get_mask_key: func
    A callable function to get new mask keys, see the
    <a href="#WebSocket.set_mask_key">WebSocket.set_mask_key</a>'s docstring for more information.
sockopt: tuple
    Values for socket.setsockopt.
    sockopt must be tuple and each element is argument of sock.setsockopt.
sslopt: dict
    Optional dict object for ssl socket options. See FAQ for details.
fire_cont_frame: bool
    Fire recv event for each cont frame. Default is False.
enable_multithread: bool
    If set to True, lock send method.
skip_utf8_validation: bool
    Skip utf8 validation.</p>
</div>


                            <div id="WebSocket.__init__" class="classattr">
                                        <input id="WebSocket.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">WebSocket</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">get_mask_key</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">sockopt</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">sslopt</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">fire_cont_frame</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">enable_multithread</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">skip_utf8_validation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">dispatcher</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="_dispatcher.html#DispatcherBase">blendmate.vendor.websocket._dispatcher.DispatcherBase</a></span><span class="p">,</span> <span class="n"><a href="_dispatcher.html#WrappedDispatcher">blendmate.vendor.websocket._dispatcher.WrappedDispatcher</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">_</span></span>)</span>

                <label class="view-source-button" for="WebSocket.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.__init__-83"><a href="#WebSocket.__init__-83"><span class="linenos"> 83</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="WebSocket.__init__-84"><a href="#WebSocket.__init__-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="WebSocket.__init__-85"><a href="#WebSocket.__init__-85"><span class="linenos"> 85</span></a>        <span class="n">get_mask_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="WebSocket.__init__-86"><a href="#WebSocket.__init__-86"><span class="linenos"> 86</span></a>        <span class="n">sockopt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="WebSocket.__init__-87"><a href="#WebSocket.__init__-87"><span class="linenos"> 87</span></a>        <span class="n">sslopt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="WebSocket.__init__-88"><a href="#WebSocket.__init__-88"><span class="linenos"> 88</span></a>        <span class="n">fire_cont_frame</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="WebSocket.__init__-89"><a href="#WebSocket.__init__-89"><span class="linenos"> 89</span></a>        <span class="n">enable_multithread</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="WebSocket.__init__-90"><a href="#WebSocket.__init__-90"><span class="linenos"> 90</span></a>        <span class="n">skip_utf8_validation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="WebSocket.__init__-91"><a href="#WebSocket.__init__-91"><span class="linenos"> 91</span></a>        <span class="n">dispatcher</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DispatcherBase</span><span class="p">,</span> <span class="n">WrappedDispatcher</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="WebSocket.__init__-92"><a href="#WebSocket.__init__-92"><span class="linenos"> 92</span></a>        <span class="o">**</span><span class="n">_</span><span class="p">,</span>
</span><span id="WebSocket.__init__-93"><a href="#WebSocket.__init__-93"><span class="linenos"> 93</span></a>    <span class="p">):</span>
</span><span id="WebSocket.__init__-94"><a href="#WebSocket.__init__-94"><span class="linenos"> 94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.__init__-95"><a href="#WebSocket.__init__-95"><span class="linenos"> 95</span></a><span class="sd">        Initialize WebSocket object.</span>
</span><span id="WebSocket.__init__-96"><a href="#WebSocket.__init__-96"><span class="linenos"> 96</span></a>
</span><span id="WebSocket.__init__-97"><a href="#WebSocket.__init__-97"><span class="linenos"> 97</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket.__init__-98"><a href="#WebSocket.__init__-98"><span class="linenos"> 98</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.__init__-99"><a href="#WebSocket.__init__-99"><span class="linenos"> 99</span></a><span class="sd">        sslopt: dict</span>
</span><span id="WebSocket.__init__-100"><a href="#WebSocket.__init__-100"><span class="linenos">100</span></a><span class="sd">            Optional dict object for ssl socket options. See FAQ for details.</span>
</span><span id="WebSocket.__init__-101"><a href="#WebSocket.__init__-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.__init__-102"><a href="#WebSocket.__init__-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span> <span class="o">=</span> <span class="n">sock_opt</span><span class="p">(</span><span class="n">sockopt</span><span class="p">,</span> <span class="n">sslopt</span><span class="p">)</span>
</span><span id="WebSocket.__init__-103"><a href="#WebSocket.__init__-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WebSocket.__init__-104"><a href="#WebSocket.__init__-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WebSocket.__init__-105"><a href="#WebSocket.__init__-105"><span class="linenos">105</span></a>
</span><span id="WebSocket.__init__-106"><a href="#WebSocket.__init__-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="WebSocket.__init__-107"><a href="#WebSocket.__init__-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_mask_key</span> <span class="o">=</span> <span class="n">get_mask_key</span>
</span><span id="WebSocket.__init__-108"><a href="#WebSocket.__init__-108"><span class="linenos">108</span></a>        <span class="c1"># These buffer over the build-up of a single frame.</span>
</span><span id="WebSocket.__init__-109"><a href="#WebSocket.__init__-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">frame_buffer</span> <span class="o">=</span> <span class="n">frame_buffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recv</span><span class="p">,</span> <span class="n">skip_utf8_validation</span><span class="p">)</span>
</span><span id="WebSocket.__init__-110"><a href="#WebSocket.__init__-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span> <span class="o">=</span> <span class="n">continuous_frame</span><span class="p">(</span><span class="n">fire_cont_frame</span><span class="p">,</span> <span class="n">skip_utf8_validation</span><span class="p">)</span>
</span><span id="WebSocket.__init__-111"><a href="#WebSocket.__init__-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispatcher</span> <span class="o">=</span> <span class="n">dispatcher</span>
</span><span id="WebSocket.__init__-112"><a href="#WebSocket.__init__-112"><span class="linenos">112</span></a>
</span><span id="WebSocket.__init__-113"><a href="#WebSocket.__init__-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="n">enable_multithread</span><span class="p">:</span>
</span><span id="WebSocket.__init__-114"><a href="#WebSocket.__init__-114"><span class="linenos">114</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="WebSocket.__init__-115"><a href="#WebSocket.__init__-115"><span class="linenos">115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">readlock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="WebSocket.__init__-116"><a href="#WebSocket.__init__-116"><span class="linenos">116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket.__init__-117"><a href="#WebSocket.__init__-117"><span class="linenos">117</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">NoLock</span><span class="p">()</span>  <span class="c1"># type: ignore[assignment]</span>
</span><span id="WebSocket.__init__-118"><a href="#WebSocket.__init__-118"><span class="linenos">118</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">readlock</span> <span class="o">=</span> <span class="n">NoLock</span><span class="p">()</span>  <span class="c1"># type: ignore[assignment]</span>
</span></pre></div>


            <div class="docstring"><p>Initialize WebSocket object.</p>

<h2 id="parameters">Parameters</h2>

<p>sslopt: dict
    Optional dict object for ssl socket options. See FAQ for details.</p>
</div>


                            </div>
                            <div id="WebSocket.sock_opt" class="classattr">
                                <div class="attr variable">
            <span class="name">sock_opt</span>

        
    </div>
    <a class="headerlink" href="#WebSocket.sock_opt"></a>
    
    

                            </div>
                            <div id="WebSocket.handshake_response" class="classattr">
                                <div class="attr variable">
            <span class="name">handshake_response</span>

        
    </div>
    <a class="headerlink" href="#WebSocket.handshake_response"></a>
    
    

                            </div>
                            <div id="WebSocket.sock" class="classattr">
                                <div class="attr variable">
            <span class="name">sock</span><span class="annotation">: Optional[socket.socket]</span>

        
    </div>
    <a class="headerlink" href="#WebSocket.sock"></a>
    
    

                            </div>
                            <div id="WebSocket.connected" class="classattr">
                                <div class="attr variable">
            <span class="name">connected</span>

        
    </div>
    <a class="headerlink" href="#WebSocket.connected"></a>
    
    

                            </div>
                            <div id="WebSocket.get_mask_key" class="classattr">
                                <div class="attr variable">
            <span class="name">get_mask_key</span>

        
    </div>
    <a class="headerlink" href="#WebSocket.get_mask_key"></a>
    
    

                            </div>
                            <div id="WebSocket.frame_buffer" class="classattr">
                                <div class="attr variable">
            <span class="name">frame_buffer</span>

        
    </div>
    <a class="headerlink" href="#WebSocket.frame_buffer"></a>
    
    

                            </div>
                            <div id="WebSocket.cont_frame" class="classattr">
                                <div class="attr variable">
            <span class="name">cont_frame</span>

        
    </div>
    <a class="headerlink" href="#WebSocket.cont_frame"></a>
    
    

                            </div>
                            <div id="WebSocket.dispatcher" class="classattr">
                                <div class="attr variable">
            <span class="name">dispatcher</span>

        
    </div>
    <a class="headerlink" href="#WebSocket.dispatcher"></a>
    
    

                            </div>
                            <div id="WebSocket.next" class="classattr">
                                        <input id="WebSocket.next-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">next</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.next-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.next"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.next-130"><a href="#WebSocket.next-130"><span class="linenos">130</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket.next-131"><a href="#WebSocket.next-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="WebSocket.fileno" class="classattr">
                                        <input id="WebSocket.fileno-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fileno</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.fileno-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.fileno"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.fileno-133"><a href="#WebSocket.fileno-133"><span class="linenos">133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fileno</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket.fileno-134"><a href="#WebSocket.fileno-134"><span class="linenos">134</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="WebSocket.set_mask_key" class="classattr">
                                        <input id="WebSocket.set_mask_key-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_mask_key</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">func</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.set_mask_key-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.set_mask_key"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.set_mask_key-136"><a href="#WebSocket.set_mask_key-136"><span class="linenos">136</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_mask_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
</span><span id="WebSocket.set_mask_key-137"><a href="#WebSocket.set_mask_key-137"><span class="linenos">137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.set_mask_key-138"><a href="#WebSocket.set_mask_key-138"><span class="linenos">138</span></a><span class="sd">        Set function to create mask key. You can customize mask key generator.</span>
</span><span id="WebSocket.set_mask_key-139"><a href="#WebSocket.set_mask_key-139"><span class="linenos">139</span></a><span class="sd">        Mainly, this is for testing purpose.</span>
</span><span id="WebSocket.set_mask_key-140"><a href="#WebSocket.set_mask_key-140"><span class="linenos">140</span></a>
</span><span id="WebSocket.set_mask_key-141"><a href="#WebSocket.set_mask_key-141"><span class="linenos">141</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket.set_mask_key-142"><a href="#WebSocket.set_mask_key-142"><span class="linenos">142</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.set_mask_key-143"><a href="#WebSocket.set_mask_key-143"><span class="linenos">143</span></a><span class="sd">        func: func</span>
</span><span id="WebSocket.set_mask_key-144"><a href="#WebSocket.set_mask_key-144"><span class="linenos">144</span></a><span class="sd">            callable object. the func takes 1 argument as integer.</span>
</span><span id="WebSocket.set_mask_key-145"><a href="#WebSocket.set_mask_key-145"><span class="linenos">145</span></a><span class="sd">            The argument means length of mask key.</span>
</span><span id="WebSocket.set_mask_key-146"><a href="#WebSocket.set_mask_key-146"><span class="linenos">146</span></a><span class="sd">            This func must return string(byte array),</span>
</span><span id="WebSocket.set_mask_key-147"><a href="#WebSocket.set_mask_key-147"><span class="linenos">147</span></a><span class="sd">            which length is argument specified.</span>
</span><span id="WebSocket.set_mask_key-148"><a href="#WebSocket.set_mask_key-148"><span class="linenos">148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.set_mask_key-149"><a href="#WebSocket.set_mask_key-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_mask_key</span> <span class="o">=</span> <span class="n">func</span>
</span></pre></div>


            <div class="docstring"><p>Set function to create mask key. You can customize mask key generator.
Mainly, this is for testing purpose.</p>

<h2 id="parameters">Parameters</h2>

<p>func: func
    callable object. the func takes 1 argument as integer.
    The argument means length of mask key.
    This func must return string(byte array),
    which length is argument specified.</p>
</div>


                            </div>
                            <div id="WebSocket.gettimeout" class="classattr">
                                        <input id="WebSocket.gettimeout-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">gettimeout</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="WebSocket.gettimeout-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.gettimeout"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.gettimeout-151"><a href="#WebSocket.gettimeout-151"><span class="linenos">151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gettimeout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="WebSocket.gettimeout-152"><a href="#WebSocket.gettimeout-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.gettimeout-153"><a href="#WebSocket.gettimeout-153"><span class="linenos">153</span></a><span class="sd">        Get the websocket timeout (in seconds) as an int or float</span>
</span><span id="WebSocket.gettimeout-154"><a href="#WebSocket.gettimeout-154"><span class="linenos">154</span></a>
</span><span id="WebSocket.gettimeout-155"><a href="#WebSocket.gettimeout-155"><span class="linenos">155</span></a><span class="sd">        Returns</span>
</span><span id="WebSocket.gettimeout-156"><a href="#WebSocket.gettimeout-156"><span class="linenos">156</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.gettimeout-157"><a href="#WebSocket.gettimeout-157"><span class="linenos">157</span></a><span class="sd">        timeout: int or float</span>
</span><span id="WebSocket.gettimeout-158"><a href="#WebSocket.gettimeout-158"><span class="linenos">158</span></a><span class="sd">             returns timeout value (in seconds). This value could be either float/integer.</span>
</span><span id="WebSocket.gettimeout-159"><a href="#WebSocket.gettimeout-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.gettimeout-160"><a href="#WebSocket.gettimeout-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="o">.</span><span class="n">timeout</span>
</span></pre></div>


            <div class="docstring"><p>Get the websocket timeout (in seconds) as an int or float</p>

<h2 id="returns">Returns</h2>

<p>timeout: int or float
     returns timeout value (in seconds). This value could be either float/integer.</p>
</div>


                            </div>
                            <div id="WebSocket.settimeout" class="classattr">
                                        <input id="WebSocket.settimeout-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">settimeout</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">timeout</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.settimeout-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.settimeout"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.settimeout-162"><a href="#WebSocket.settimeout-162"><span class="linenos">162</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">settimeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]):</span>
</span><span id="WebSocket.settimeout-163"><a href="#WebSocket.settimeout-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.settimeout-164"><a href="#WebSocket.settimeout-164"><span class="linenos">164</span></a><span class="sd">        Set the timeout to the websocket.</span>
</span><span id="WebSocket.settimeout-165"><a href="#WebSocket.settimeout-165"><span class="linenos">165</span></a>
</span><span id="WebSocket.settimeout-166"><a href="#WebSocket.settimeout-166"><span class="linenos">166</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket.settimeout-167"><a href="#WebSocket.settimeout-167"><span class="linenos">167</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.settimeout-168"><a href="#WebSocket.settimeout-168"><span class="linenos">168</span></a><span class="sd">        timeout: int or float</span>
</span><span id="WebSocket.settimeout-169"><a href="#WebSocket.settimeout-169"><span class="linenos">169</span></a><span class="sd">            timeout time (in seconds). This value could be either float/integer.</span>
</span><span id="WebSocket.settimeout-170"><a href="#WebSocket.settimeout-170"><span class="linenos">170</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.settimeout-171"><a href="#WebSocket.settimeout-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
</span><span id="WebSocket.settimeout-172"><a href="#WebSocket.settimeout-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span>
</span><span id="WebSocket.settimeout-173"><a href="#WebSocket.settimeout-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the timeout to the websocket.</p>

<h2 id="parameters">Parameters</h2>

<p>timeout: int or float
    timeout time (in seconds). This value could be either float/integer.</p>
</div>


                            </div>
                            <div id="WebSocket.timeout" class="classattr">
                                        <input id="WebSocket.timeout-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">timeout</span><span class="annotation">: Union[int, float, NoneType]</span>

                <label class="view-source-button" for="WebSocket.timeout-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.timeout"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.timeout-151"><a href="#WebSocket.timeout-151"><span class="linenos">151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gettimeout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="WebSocket.timeout-152"><a href="#WebSocket.timeout-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.timeout-153"><a href="#WebSocket.timeout-153"><span class="linenos">153</span></a><span class="sd">        Get the websocket timeout (in seconds) as an int or float</span>
</span><span id="WebSocket.timeout-154"><a href="#WebSocket.timeout-154"><span class="linenos">154</span></a>
</span><span id="WebSocket.timeout-155"><a href="#WebSocket.timeout-155"><span class="linenos">155</span></a><span class="sd">        Returns</span>
</span><span id="WebSocket.timeout-156"><a href="#WebSocket.timeout-156"><span class="linenos">156</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.timeout-157"><a href="#WebSocket.timeout-157"><span class="linenos">157</span></a><span class="sd">        timeout: int or float</span>
</span><span id="WebSocket.timeout-158"><a href="#WebSocket.timeout-158"><span class="linenos">158</span></a><span class="sd">             returns timeout value (in seconds). This value could be either float/integer.</span>
</span><span id="WebSocket.timeout-159"><a href="#WebSocket.timeout-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.timeout-160"><a href="#WebSocket.timeout-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="o">.</span><span class="n">timeout</span>
</span></pre></div>


            <div class="docstring"><p>Get the websocket timeout (in seconds) as an int or float</p>

<h2 id="returns">Returns</h2>

<p>timeout: int or float
     returns timeout value (in seconds). This value could be either float/integer.</p>
</div>


                            </div>
                            <div id="WebSocket.getsubprotocol" class="classattr">
                                        <input id="WebSocket.getsubprotocol-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getsubprotocol</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.getsubprotocol-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.getsubprotocol"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.getsubprotocol-177"><a href="#WebSocket.getsubprotocol-177"><span class="linenos">177</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getsubprotocol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket.getsubprotocol-178"><a href="#WebSocket.getsubprotocol-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.getsubprotocol-179"><a href="#WebSocket.getsubprotocol-179"><span class="linenos">179</span></a><span class="sd">        Get subprotocol</span>
</span><span id="WebSocket.getsubprotocol-180"><a href="#WebSocket.getsubprotocol-180"><span class="linenos">180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.getsubprotocol-181"><a href="#WebSocket.getsubprotocol-181"><span class="linenos">181</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="p">:</span>
</span><span id="WebSocket.getsubprotocol-182"><a href="#WebSocket.getsubprotocol-182"><span class="linenos">182</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">subprotocol</span>
</span><span id="WebSocket.getsubprotocol-183"><a href="#WebSocket.getsubprotocol-183"><span class="linenos">183</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket.getsubprotocol-184"><a href="#WebSocket.getsubprotocol-184"><span class="linenos">184</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Get subprotocol</p>
</div>


                            </div>
                            <div id="WebSocket.subprotocol" class="classattr">
                                        <input id="WebSocket.subprotocol-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">subprotocol</span>

                <label class="view-source-button" for="WebSocket.subprotocol-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.subprotocol"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.subprotocol-177"><a href="#WebSocket.subprotocol-177"><span class="linenos">177</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getsubprotocol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket.subprotocol-178"><a href="#WebSocket.subprotocol-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.subprotocol-179"><a href="#WebSocket.subprotocol-179"><span class="linenos">179</span></a><span class="sd">        Get subprotocol</span>
</span><span id="WebSocket.subprotocol-180"><a href="#WebSocket.subprotocol-180"><span class="linenos">180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.subprotocol-181"><a href="#WebSocket.subprotocol-181"><span class="linenos">181</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="p">:</span>
</span><span id="WebSocket.subprotocol-182"><a href="#WebSocket.subprotocol-182"><span class="linenos">182</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">subprotocol</span>
</span><span id="WebSocket.subprotocol-183"><a href="#WebSocket.subprotocol-183"><span class="linenos">183</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket.subprotocol-184"><a href="#WebSocket.subprotocol-184"><span class="linenos">184</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Get subprotocol</p>
</div>


                            </div>
                            <div id="WebSocket.getstatus" class="classattr">
                                        <input id="WebSocket.getstatus-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getstatus</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.getstatus-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.getstatus"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.getstatus-188"><a href="#WebSocket.getstatus-188"><span class="linenos">188</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getstatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket.getstatus-189"><a href="#WebSocket.getstatus-189"><span class="linenos">189</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.getstatus-190"><a href="#WebSocket.getstatus-190"><span class="linenos">190</span></a><span class="sd">        Get handshake status</span>
</span><span id="WebSocket.getstatus-191"><a href="#WebSocket.getstatus-191"><span class="linenos">191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.getstatus-192"><a href="#WebSocket.getstatus-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="p">:</span>
</span><span id="WebSocket.getstatus-193"><a href="#WebSocket.getstatus-193"><span class="linenos">193</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">status</span>
</span><span id="WebSocket.getstatus-194"><a href="#WebSocket.getstatus-194"><span class="linenos">194</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket.getstatus-195"><a href="#WebSocket.getstatus-195"><span class="linenos">195</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Get handshake status</p>
</div>


                            </div>
                            <div id="WebSocket.status" class="classattr">
                                        <input id="WebSocket.status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">status</span>

                <label class="view-source-button" for="WebSocket.status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.status-188"><a href="#WebSocket.status-188"><span class="linenos">188</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getstatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket.status-189"><a href="#WebSocket.status-189"><span class="linenos">189</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.status-190"><a href="#WebSocket.status-190"><span class="linenos">190</span></a><span class="sd">        Get handshake status</span>
</span><span id="WebSocket.status-191"><a href="#WebSocket.status-191"><span class="linenos">191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.status-192"><a href="#WebSocket.status-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="p">:</span>
</span><span id="WebSocket.status-193"><a href="#WebSocket.status-193"><span class="linenos">193</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">status</span>
</span><span id="WebSocket.status-194"><a href="#WebSocket.status-194"><span class="linenos">194</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket.status-195"><a href="#WebSocket.status-195"><span class="linenos">195</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Get handshake status</p>
</div>


                            </div>
                            <div id="WebSocket.getheaders" class="classattr">
                                        <input id="WebSocket.getheaders-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getheaders</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.getheaders-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.getheaders"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.getheaders-199"><a href="#WebSocket.getheaders-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getheaders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket.getheaders-200"><a href="#WebSocket.getheaders-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.getheaders-201"><a href="#WebSocket.getheaders-201"><span class="linenos">201</span></a><span class="sd">        Get handshake response header</span>
</span><span id="WebSocket.getheaders-202"><a href="#WebSocket.getheaders-202"><span class="linenos">202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.getheaders-203"><a href="#WebSocket.getheaders-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="p">:</span>
</span><span id="WebSocket.getheaders-204"><a href="#WebSocket.getheaders-204"><span class="linenos">204</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">headers</span>
</span><span id="WebSocket.getheaders-205"><a href="#WebSocket.getheaders-205"><span class="linenos">205</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket.getheaders-206"><a href="#WebSocket.getheaders-206"><span class="linenos">206</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Get handshake response header</p>
</div>


                            </div>
                            <div id="WebSocket.is_ssl" class="classattr">
                                        <input id="WebSocket.is_ssl-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_ssl</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.is_ssl-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.is_ssl"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.is_ssl-208"><a href="#WebSocket.is_ssl-208"><span class="linenos">208</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_ssl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket.is_ssl-209"><a href="#WebSocket.is_ssl-209"><span class="linenos">209</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="WebSocket.is_ssl-210"><a href="#WebSocket.is_ssl-210"><span class="linenos">210</span></a>            <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>
</span><span id="WebSocket.is_ssl-211"><a href="#WebSocket.is_ssl-211"><span class="linenos">211</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
</span><span id="WebSocket.is_ssl-212"><a href="#WebSocket.is_ssl-212"><span class="linenos">212</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


    

                            </div>
                            <div id="WebSocket.headers" class="classattr">
                                        <input id="WebSocket.headers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">headers</span>

                <label class="view-source-button" for="WebSocket.headers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.headers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.headers-199"><a href="#WebSocket.headers-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getheaders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket.headers-200"><a href="#WebSocket.headers-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.headers-201"><a href="#WebSocket.headers-201"><span class="linenos">201</span></a><span class="sd">        Get handshake response header</span>
</span><span id="WebSocket.headers-202"><a href="#WebSocket.headers-202"><span class="linenos">202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.headers-203"><a href="#WebSocket.headers-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="p">:</span>
</span><span id="WebSocket.headers-204"><a href="#WebSocket.headers-204"><span class="linenos">204</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">headers</span>
</span><span id="WebSocket.headers-205"><a href="#WebSocket.headers-205"><span class="linenos">205</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket.headers-206"><a href="#WebSocket.headers-206"><span class="linenos">206</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Get handshake response header</p>
</div>


                            </div>
                            <div id="WebSocket.connect" class="classattr">
                                        <input id="WebSocket.connect-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">connect</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">url</span>, </span><span class="param"><span class="o">**</span><span class="n">options</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.connect-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.connect"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.connect-216"><a href="#WebSocket.connect-216"><span class="linenos">216</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="WebSocket.connect-217"><a href="#WebSocket.connect-217"><span class="linenos">217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.connect-218"><a href="#WebSocket.connect-218"><span class="linenos">218</span></a><span class="sd">        Connect to url. url is websocket url scheme.</span>
</span><span id="WebSocket.connect-219"><a href="#WebSocket.connect-219"><span class="linenos">219</span></a><span class="sd">        ie. ws://host:port/resource</span>
</span><span id="WebSocket.connect-220"><a href="#WebSocket.connect-220"><span class="linenos">220</span></a><span class="sd">        You can customize using &#39;options&#39;.</span>
</span><span id="WebSocket.connect-221"><a href="#WebSocket.connect-221"><span class="linenos">221</span></a><span class="sd">        If you set &quot;header&quot; list object, you can set your own custom header.</span>
</span><span id="WebSocket.connect-222"><a href="#WebSocket.connect-222"><span class="linenos">222</span></a>
</span><span id="WebSocket.connect-223"><a href="#WebSocket.connect-223"><span class="linenos">223</span></a><span class="sd">        &gt;&gt;&gt; ws = WebSocket()</span>
</span><span id="WebSocket.connect-224"><a href="#WebSocket.connect-224"><span class="linenos">224</span></a><span class="sd">        &gt;&gt;&gt; ws.connect(&quot;ws://echo.websocket.events&quot;,</span>
</span><span id="WebSocket.connect-225"><a href="#WebSocket.connect-225"><span class="linenos">225</span></a><span class="sd">                ...     header=[&quot;User-Agent: MyProgram&quot;,</span>
</span><span id="WebSocket.connect-226"><a href="#WebSocket.connect-226"><span class="linenos">226</span></a><span class="sd">                ...             &quot;x-custom: header&quot;])</span>
</span><span id="WebSocket.connect-227"><a href="#WebSocket.connect-227"><span class="linenos">227</span></a>
</span><span id="WebSocket.connect-228"><a href="#WebSocket.connect-228"><span class="linenos">228</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket.connect-229"><a href="#WebSocket.connect-229"><span class="linenos">229</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.connect-230"><a href="#WebSocket.connect-230"><span class="linenos">230</span></a><span class="sd">        header: list or dict</span>
</span><span id="WebSocket.connect-231"><a href="#WebSocket.connect-231"><span class="linenos">231</span></a><span class="sd">            Custom http header list or dict.</span>
</span><span id="WebSocket.connect-232"><a href="#WebSocket.connect-232"><span class="linenos">232</span></a><span class="sd">        cookie: str</span>
</span><span id="WebSocket.connect-233"><a href="#WebSocket.connect-233"><span class="linenos">233</span></a><span class="sd">            Cookie value.</span>
</span><span id="WebSocket.connect-234"><a href="#WebSocket.connect-234"><span class="linenos">234</span></a><span class="sd">        origin: str</span>
</span><span id="WebSocket.connect-235"><a href="#WebSocket.connect-235"><span class="linenos">235</span></a><span class="sd">            Custom origin url.</span>
</span><span id="WebSocket.connect-236"><a href="#WebSocket.connect-236"><span class="linenos">236</span></a><span class="sd">        connection: str</span>
</span><span id="WebSocket.connect-237"><a href="#WebSocket.connect-237"><span class="linenos">237</span></a><span class="sd">            Custom connection header value.</span>
</span><span id="WebSocket.connect-238"><a href="#WebSocket.connect-238"><span class="linenos">238</span></a><span class="sd">            Default value &quot;Upgrade&quot; set in _handshake.py</span>
</span><span id="WebSocket.connect-239"><a href="#WebSocket.connect-239"><span class="linenos">239</span></a><span class="sd">        suppress_origin: bool</span>
</span><span id="WebSocket.connect-240"><a href="#WebSocket.connect-240"><span class="linenos">240</span></a><span class="sd">            Suppress outputting origin header.</span>
</span><span id="WebSocket.connect-241"><a href="#WebSocket.connect-241"><span class="linenos">241</span></a><span class="sd">        host: str</span>
</span><span id="WebSocket.connect-242"><a href="#WebSocket.connect-242"><span class="linenos">242</span></a><span class="sd">            Custom host header string.</span>
</span><span id="WebSocket.connect-243"><a href="#WebSocket.connect-243"><span class="linenos">243</span></a><span class="sd">        timeout: int or float</span>
</span><span id="WebSocket.connect-244"><a href="#WebSocket.connect-244"><span class="linenos">244</span></a><span class="sd">            Socket timeout time. This value is an integer or float.</span>
</span><span id="WebSocket.connect-245"><a href="#WebSocket.connect-245"><span class="linenos">245</span></a><span class="sd">            If you set None for this value, it means &quot;use default_timeout value&quot;</span>
</span><span id="WebSocket.connect-246"><a href="#WebSocket.connect-246"><span class="linenos">246</span></a><span class="sd">        http_proxy_host: str</span>
</span><span id="WebSocket.connect-247"><a href="#WebSocket.connect-247"><span class="linenos">247</span></a><span class="sd">            HTTP proxy host name.</span>
</span><span id="WebSocket.connect-248"><a href="#WebSocket.connect-248"><span class="linenos">248</span></a><span class="sd">        http_proxy_port: str or int</span>
</span><span id="WebSocket.connect-249"><a href="#WebSocket.connect-249"><span class="linenos">249</span></a><span class="sd">            HTTP proxy port. Default is 80.</span>
</span><span id="WebSocket.connect-250"><a href="#WebSocket.connect-250"><span class="linenos">250</span></a><span class="sd">        http_no_proxy: list</span>
</span><span id="WebSocket.connect-251"><a href="#WebSocket.connect-251"><span class="linenos">251</span></a><span class="sd">            Whitelisted host names that don&#39;t use the proxy.</span>
</span><span id="WebSocket.connect-252"><a href="#WebSocket.connect-252"><span class="linenos">252</span></a><span class="sd">        http_proxy_auth: tuple</span>
</span><span id="WebSocket.connect-253"><a href="#WebSocket.connect-253"><span class="linenos">253</span></a><span class="sd">            HTTP proxy auth information. Tuple of username and password. Default is None.</span>
</span><span id="WebSocket.connect-254"><a href="#WebSocket.connect-254"><span class="linenos">254</span></a><span class="sd">        http_proxy_timeout: int or float</span>
</span><span id="WebSocket.connect-255"><a href="#WebSocket.connect-255"><span class="linenos">255</span></a><span class="sd">            HTTP proxy timeout, default is 60 sec as per python-socks.</span>
</span><span id="WebSocket.connect-256"><a href="#WebSocket.connect-256"><span class="linenos">256</span></a><span class="sd">        redirect_limit: int</span>
</span><span id="WebSocket.connect-257"><a href="#WebSocket.connect-257"><span class="linenos">257</span></a><span class="sd">            Number of redirects to follow.</span>
</span><span id="WebSocket.connect-258"><a href="#WebSocket.connect-258"><span class="linenos">258</span></a><span class="sd">        subprotocols: list</span>
</span><span id="WebSocket.connect-259"><a href="#WebSocket.connect-259"><span class="linenos">259</span></a><span class="sd">            List of available subprotocols. Default is None.</span>
</span><span id="WebSocket.connect-260"><a href="#WebSocket.connect-260"><span class="linenos">260</span></a><span class="sd">        socket: socket</span>
</span><span id="WebSocket.connect-261"><a href="#WebSocket.connect-261"><span class="linenos">261</span></a><span class="sd">            Pre-initialized stream socket.</span>
</span><span id="WebSocket.connect-262"><a href="#WebSocket.connect-262"><span class="linenos">262</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.connect-263"><a href="#WebSocket.connect-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="WebSocket.connect-264"><a href="#WebSocket.connect-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">addrs</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span>
</span><span id="WebSocket.connect-265"><a href="#WebSocket.connect-265"><span class="linenos">265</span></a>            <span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="p">,</span> <span class="n">proxy_info</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">),</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;socket&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="WebSocket.connect-266"><a href="#WebSocket.connect-266"><span class="linenos">266</span></a>        <span class="p">)</span>
</span><span id="WebSocket.connect-267"><a href="#WebSocket.connect-267"><span class="linenos">267</span></a>
</span><span id="WebSocket.connect-268"><a href="#WebSocket.connect-268"><span class="linenos">268</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="WebSocket.connect-269"><a href="#WebSocket.connect-269"><span class="linenos">269</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span> <span class="o">=</span> <span class="n">handshake</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">*</span><span class="n">addrs</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="WebSocket.connect-270"><a href="#WebSocket.connect-270"><span class="linenos">270</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;redirect_limit&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
</span><span id="WebSocket.connect-271"><a href="#WebSocket.connect-271"><span class="linenos">271</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="n">SUPPORTED_REDIRECT_STATUSES</span><span class="p">:</span>
</span><span id="WebSocket.connect-272"><a href="#WebSocket.connect-272"><span class="linenos">272</span></a>                    <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]</span>
</span><span id="WebSocket.connect-273"><a href="#WebSocket.connect-273"><span class="linenos">273</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="WebSocket.connect-274"><a href="#WebSocket.connect-274"><span class="linenos">274</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">addrs</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span>
</span><span id="WebSocket.connect-275"><a href="#WebSocket.connect-275"><span class="linenos">275</span></a>                        <span class="n">url</span><span class="p">,</span>
</span><span id="WebSocket.connect-276"><a href="#WebSocket.connect-276"><span class="linenos">276</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sock_opt</span><span class="p">,</span>
</span><span id="WebSocket.connect-277"><a href="#WebSocket.connect-277"><span class="linenos">277</span></a>                        <span class="n">proxy_info</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">),</span>
</span><span id="WebSocket.connect-278"><a href="#WebSocket.connect-278"><span class="linenos">278</span></a>                        <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;socket&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="WebSocket.connect-279"><a href="#WebSocket.connect-279"><span class="linenos">279</span></a>                    <span class="p">)</span>
</span><span id="WebSocket.connect-280"><a href="#WebSocket.connect-280"><span class="linenos">280</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">handshake_response</span> <span class="o">=</span> <span class="n">handshake</span><span class="p">(</span>
</span><span id="WebSocket.connect-281"><a href="#WebSocket.connect-281"><span class="linenos">281</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">*</span><span class="n">addrs</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span>
</span><span id="WebSocket.connect-282"><a href="#WebSocket.connect-282"><span class="linenos">282</span></a>                    <span class="p">)</span>
</span><span id="WebSocket.connect-283"><a href="#WebSocket.connect-283"><span class="linenos">283</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="WebSocket.connect-284"><a href="#WebSocket.connect-284"><span class="linenos">284</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="WebSocket.connect-285"><a href="#WebSocket.connect-285"><span class="linenos">285</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span>
</span><span id="WebSocket.connect-286"><a href="#WebSocket.connect-286"><span class="linenos">286</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="WebSocket.connect-287"><a href="#WebSocket.connect-287"><span class="linenos">287</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WebSocket.connect-288"><a href="#WebSocket.connect-288"><span class="linenos">288</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Connect to url. url is websocket url scheme.
ie. ws://host:port/resource
You can customize using 'options'.
If you set "header" list object, you can set your own custom header.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span> <span class="o">=</span> <span class="n">WebSocket</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;ws://echo.websocket.events&quot;</span><span class="p">,</span>
<span class="go">        ...     header=[&quot;User-Agent: MyProgram&quot;,</span>
<span class="go">        ...             &quot;x-custom: header&quot;])</span>
</code></pre>
</div>

<h2 id="parameters">Parameters</h2>

<p>header: list or dict
    Custom http header list or dict.
cookie: str
    Cookie value.
origin: str
    Custom origin url.
connection: str
    Custom connection header value.
    Default value "Upgrade" set in _handshake.py
suppress_origin: bool
    Suppress outputting origin header.
host: str
    Custom host header string.
timeout: int or float
    Socket timeout time. This value is an integer or float.
    If you set None for this value, it means "use default_timeout value"
http_proxy_host: str
    HTTP proxy host name.
http_proxy_port: str or int
    HTTP proxy port. Default is 80.
http_no_proxy: list
    Whitelisted host names that don't use the proxy.
http_proxy_auth: tuple
    HTTP proxy auth information. Tuple of username and password. Default is None.
http_proxy_timeout: int or float
    HTTP proxy timeout, default is 60 sec as per python-socks.
redirect_limit: int
    Number of redirects to follow.
subprotocols: list
    List of available subprotocols. Default is None.
socket: socket
    Pre-initialized stream socket.</p>
</div>


                            </div>
                            <div id="WebSocket.send" class="classattr">
                                        <input id="WebSocket.send-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">send</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>, </span><span class="param"><span class="n">opcode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="WebSocket.send-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.send"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.send-290"><a href="#WebSocket.send-290"><span class="linenos">290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">opcode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_TEXT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="WebSocket.send-291"><a href="#WebSocket.send-291"><span class="linenos">291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.send-292"><a href="#WebSocket.send-292"><span class="linenos">292</span></a><span class="sd">        Send the data as string.</span>
</span><span id="WebSocket.send-293"><a href="#WebSocket.send-293"><span class="linenos">293</span></a>
</span><span id="WebSocket.send-294"><a href="#WebSocket.send-294"><span class="linenos">294</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket.send-295"><a href="#WebSocket.send-295"><span class="linenos">295</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.send-296"><a href="#WebSocket.send-296"><span class="linenos">296</span></a><span class="sd">        payload: str</span>
</span><span id="WebSocket.send-297"><a href="#WebSocket.send-297"><span class="linenos">297</span></a><span class="sd">            Payload must be utf-8 string or unicode,</span>
</span><span id="WebSocket.send-298"><a href="#WebSocket.send-298"><span class="linenos">298</span></a><span class="sd">            If the opcode is OPCODE_TEXT.</span>
</span><span id="WebSocket.send-299"><a href="#WebSocket.send-299"><span class="linenos">299</span></a><span class="sd">            Otherwise, it must be string(byte array).</span>
</span><span id="WebSocket.send-300"><a href="#WebSocket.send-300"><span class="linenos">300</span></a><span class="sd">        opcode: int</span>
</span><span id="WebSocket.send-301"><a href="#WebSocket.send-301"><span class="linenos">301</span></a><span class="sd">            Operation code (opcode) to send.</span>
</span><span id="WebSocket.send-302"><a href="#WebSocket.send-302"><span class="linenos">302</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.send-303"><a href="#WebSocket.send-303"><span class="linenos">303</span></a>
</span><span id="WebSocket.send-304"><a href="#WebSocket.send-304"><span class="linenos">304</span></a>        <span class="n">frame</span> <span class="o">=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">create_frame</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">opcode</span><span class="p">)</span>
</span><span id="WebSocket.send-305"><a href="#WebSocket.send-305"><span class="linenos">305</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Send the data as string.</p>

<h2 id="parameters">Parameters</h2>

<p>payload: str
    Payload must be utf-8 string or unicode,
    If the opcode is OPCODE_TEXT.
    Otherwise, it must be string(byte array).
opcode: int
    Operation code (opcode) to send.</p>
</div>


                            </div>
                            <div id="WebSocket.send_text" class="classattr">
                                        <input id="WebSocket.send_text-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">send_text</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">text_data</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="WebSocket.send_text-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.send_text"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.send_text-307"><a href="#WebSocket.send_text-307"><span class="linenos">307</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="WebSocket.send_text-308"><a href="#WebSocket.send_text-308"><span class="linenos">308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.send_text-309"><a href="#WebSocket.send_text-309"><span class="linenos">309</span></a><span class="sd">        Sends UTF-8 encoded text.</span>
</span><span id="WebSocket.send_text-310"><a href="#WebSocket.send_text-310"><span class="linenos">310</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.send_text-311"><a href="#WebSocket.send_text-311"><span class="linenos">311</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">text_data</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_TEXT</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sends UTF-8 encoded text.</p>
</div>


                            </div>
                            <div id="WebSocket.send_bytes" class="classattr">
                                        <input id="WebSocket.send_bytes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">send_bytes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="WebSocket.send_bytes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.send_bytes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.send_bytes-313"><a href="#WebSocket.send_bytes-313"><span class="linenos">313</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="WebSocket.send_bytes-314"><a href="#WebSocket.send_bytes-314"><span class="linenos">314</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.send_bytes-315"><a href="#WebSocket.send_bytes-315"><span class="linenos">315</span></a><span class="sd">        Sends a sequence of bytes.</span>
</span><span id="WebSocket.send_bytes-316"><a href="#WebSocket.send_bytes-316"><span class="linenos">316</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.send_bytes-317"><a href="#WebSocket.send_bytes-317"><span class="linenos">317</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_BINARY</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sends a sequence of bytes.</p>
</div>


                            </div>
                            <div id="WebSocket.send_frame" class="classattr">
                                        <input id="WebSocket.send_frame-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">send_frame</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">frame</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="WebSocket.send_frame-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.send_frame"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.send_frame-319"><a href="#WebSocket.send_frame-319"><span class="linenos">319</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="WebSocket.send_frame-320"><a href="#WebSocket.send_frame-320"><span class="linenos">320</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.send_frame-321"><a href="#WebSocket.send_frame-321"><span class="linenos">321</span></a><span class="sd">        Send the data frame.</span>
</span><span id="WebSocket.send_frame-322"><a href="#WebSocket.send_frame-322"><span class="linenos">322</span></a>
</span><span id="WebSocket.send_frame-323"><a href="#WebSocket.send_frame-323"><span class="linenos">323</span></a><span class="sd">        &gt;&gt;&gt; ws = create_connection(&quot;ws://echo.websocket.events&quot;)</span>
</span><span id="WebSocket.send_frame-324"><a href="#WebSocket.send_frame-324"><span class="linenos">324</span></a><span class="sd">        &gt;&gt;&gt; frame = ABNF.create_frame(&quot;Hello&quot;, ABNF.OPCODE_TEXT)</span>
</span><span id="WebSocket.send_frame-325"><a href="#WebSocket.send_frame-325"><span class="linenos">325</span></a><span class="sd">        &gt;&gt;&gt; ws.send_frame(frame)</span>
</span><span id="WebSocket.send_frame-326"><a href="#WebSocket.send_frame-326"><span class="linenos">326</span></a><span class="sd">        &gt;&gt;&gt; cont_frame = ABNF.create_frame(&quot;My name is &quot;, ABNF.OPCODE_CONT, 0)</span>
</span><span id="WebSocket.send_frame-327"><a href="#WebSocket.send_frame-327"><span class="linenos">327</span></a><span class="sd">        &gt;&gt;&gt; ws.send_frame(frame)</span>
</span><span id="WebSocket.send_frame-328"><a href="#WebSocket.send_frame-328"><span class="linenos">328</span></a><span class="sd">        &gt;&gt;&gt; cont_frame = ABNF.create_frame(&quot;Foo Bar&quot;, ABNF.OPCODE_CONT, 1)</span>
</span><span id="WebSocket.send_frame-329"><a href="#WebSocket.send_frame-329"><span class="linenos">329</span></a><span class="sd">        &gt;&gt;&gt; ws.send_frame(frame)</span>
</span><span id="WebSocket.send_frame-330"><a href="#WebSocket.send_frame-330"><span class="linenos">330</span></a>
</span><span id="WebSocket.send_frame-331"><a href="#WebSocket.send_frame-331"><span class="linenos">331</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket.send_frame-332"><a href="#WebSocket.send_frame-332"><span class="linenos">332</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.send_frame-333"><a href="#WebSocket.send_frame-333"><span class="linenos">333</span></a><span class="sd">        frame: ABNF frame</span>
</span><span id="WebSocket.send_frame-334"><a href="#WebSocket.send_frame-334"><span class="linenos">334</span></a><span class="sd">            frame data created by ABNF.create_frame</span>
</span><span id="WebSocket.send_frame-335"><a href="#WebSocket.send_frame-335"><span class="linenos">335</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.send_frame-336"><a href="#WebSocket.send_frame-336"><span class="linenos">336</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mask_key</span><span class="p">:</span>
</span><span id="WebSocket.send_frame-337"><a href="#WebSocket.send_frame-337"><span class="linenos">337</span></a>            <span class="n">frame</span><span class="o">.</span><span class="n">get_mask_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mask_key</span>
</span><span id="WebSocket.send_frame-338"><a href="#WebSocket.send_frame-338"><span class="linenos">338</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
</span><span id="WebSocket.send_frame-339"><a href="#WebSocket.send_frame-339"><span class="linenos">339</span></a>        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="WebSocket.send_frame-340"><a href="#WebSocket.send_frame-340"><span class="linenos">340</span></a>        <span class="k">if</span> <span class="n">isEnabledForTrace</span><span class="p">():</span>
</span><span id="WebSocket.send_frame-341"><a href="#WebSocket.send_frame-341"><span class="linenos">341</span></a>            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;++Sent raw: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WebSocket.send_frame-342"><a href="#WebSocket.send_frame-342"><span class="linenos">342</span></a>            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;++Sent decoded: </span><span class="si">{</span><span class="n">frame</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WebSocket.send_frame-343"><a href="#WebSocket.send_frame-343"><span class="linenos">343</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span><span id="WebSocket.send_frame-344"><a href="#WebSocket.send_frame-344"><span class="linenos">344</span></a>            <span class="k">while</span> <span class="n">data</span><span class="p">:</span>
</span><span id="WebSocket.send_frame-345"><a href="#WebSocket.send_frame-345"><span class="linenos">345</span></a>                <span class="n">bytes_sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="WebSocket.send_frame-346"><a href="#WebSocket.send_frame-346"><span class="linenos">346</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">bytes_sent</span><span class="p">:]</span>
</span><span id="WebSocket.send_frame-347"><a href="#WebSocket.send_frame-347"><span class="linenos">347</span></a>
</span><span id="WebSocket.send_frame-348"><a href="#WebSocket.send_frame-348"><span class="linenos">348</span></a>        <span class="k">return</span> <span class="n">length</span>
</span></pre></div>


            <div class="docstring"><p>Send the data frame.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span> <span class="o">=</span> <span class="n">create_connection</span><span class="p">(</span><span class="s2">&quot;ws://echo.websocket.events&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">frame</span> <span class="o">=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">create_frame</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_TEXT</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span><span class="o">.</span><span class="n">send_frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cont_frame</span> <span class="o">=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">create_frame</span><span class="p">(</span><span class="s2">&quot;My name is &quot;</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CONT</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span><span class="o">.</span><span class="n">send_frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cont_frame</span> <span class="o">=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">create_frame</span><span class="p">(</span><span class="s2">&quot;Foo Bar&quot;</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CONT</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span><span class="o">.</span><span class="n">send_frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="parameters">Parameters</h2>

<p>frame: ABNF frame
    frame data created by ABNF.create_frame</p>
</div>


                            </div>
                            <div id="WebSocket.send_binary" class="classattr">
                                        <input id="WebSocket.send_binary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">send_binary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">payload</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="WebSocket.send_binary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.send_binary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.send_binary-350"><a href="#WebSocket.send_binary-350"><span class="linenos">350</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="WebSocket.send_binary-351"><a href="#WebSocket.send_binary-351"><span class="linenos">351</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.send_binary-352"><a href="#WebSocket.send_binary-352"><span class="linenos">352</span></a><span class="sd">        Send a binary message (OPCODE_BINARY).</span>
</span><span id="WebSocket.send_binary-353"><a href="#WebSocket.send_binary-353"><span class="linenos">353</span></a>
</span><span id="WebSocket.send_binary-354"><a href="#WebSocket.send_binary-354"><span class="linenos">354</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket.send_binary-355"><a href="#WebSocket.send_binary-355"><span class="linenos">355</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.send_binary-356"><a href="#WebSocket.send_binary-356"><span class="linenos">356</span></a><span class="sd">        payload: bytes</span>
</span><span id="WebSocket.send_binary-357"><a href="#WebSocket.send_binary-357"><span class="linenos">357</span></a><span class="sd">            payload of message to send.</span>
</span><span id="WebSocket.send_binary-358"><a href="#WebSocket.send_binary-358"><span class="linenos">358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.send_binary-359"><a href="#WebSocket.send_binary-359"><span class="linenos">359</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_BINARY</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Send a binary message (OPCODE_BINARY).</p>

<h2 id="parameters">Parameters</h2>

<p>payload: bytes
    payload of message to send.</p>
</div>


                            </div>
                            <div id="WebSocket.ping" class="classattr">
                                        <input id="WebSocket.ping-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ping</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.ping-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.ping"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.ping-361"><a href="#WebSocket.ping-361"><span class="linenos">361</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="WebSocket.ping-362"><a href="#WebSocket.ping-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.ping-363"><a href="#WebSocket.ping-363"><span class="linenos">363</span></a><span class="sd">        Send ping data.</span>
</span><span id="WebSocket.ping-364"><a href="#WebSocket.ping-364"><span class="linenos">364</span></a>
</span><span id="WebSocket.ping-365"><a href="#WebSocket.ping-365"><span class="linenos">365</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket.ping-366"><a href="#WebSocket.ping-366"><span class="linenos">366</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.ping-367"><a href="#WebSocket.ping-367"><span class="linenos">367</span></a><span class="sd">        payload: str</span>
</span><span id="WebSocket.ping-368"><a href="#WebSocket.ping-368"><span class="linenos">368</span></a><span class="sd">            data payload to send server.</span>
</span><span id="WebSocket.ping-369"><a href="#WebSocket.ping-369"><span class="linenos">369</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.ping-370"><a href="#WebSocket.ping-370"><span class="linenos">370</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="WebSocket.ping-371"><a href="#WebSocket.ping-371"><span class="linenos">371</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="WebSocket.ping-372"><a href="#WebSocket.ping-372"><span class="linenos">372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_PING</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Send ping data.</p>

<h2 id="parameters">Parameters</h2>

<p>payload: str
    data payload to send server.</p>
</div>


                            </div>
                            <div id="WebSocket.pong" class="classattr">
                                        <input id="WebSocket.pong-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pong</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.pong-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.pong"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.pong-374"><a href="#WebSocket.pong-374"><span class="linenos">374</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">pong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="WebSocket.pong-375"><a href="#WebSocket.pong-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.pong-376"><a href="#WebSocket.pong-376"><span class="linenos">376</span></a><span class="sd">        Send pong data.</span>
</span><span id="WebSocket.pong-377"><a href="#WebSocket.pong-377"><span class="linenos">377</span></a>
</span><span id="WebSocket.pong-378"><a href="#WebSocket.pong-378"><span class="linenos">378</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket.pong-379"><a href="#WebSocket.pong-379"><span class="linenos">379</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.pong-380"><a href="#WebSocket.pong-380"><span class="linenos">380</span></a><span class="sd">        payload: str</span>
</span><span id="WebSocket.pong-381"><a href="#WebSocket.pong-381"><span class="linenos">381</span></a><span class="sd">            data payload to send server.</span>
</span><span id="WebSocket.pong-382"><a href="#WebSocket.pong-382"><span class="linenos">382</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.pong-383"><a href="#WebSocket.pong-383"><span class="linenos">383</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="WebSocket.pong-384"><a href="#WebSocket.pong-384"><span class="linenos">384</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="WebSocket.pong-385"><a href="#WebSocket.pong-385"><span class="linenos">385</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_PONG</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Send pong data.</p>

<h2 id="parameters">Parameters</h2>

<p>payload: str
    data payload to send server.</p>
</div>


                            </div>
                            <div id="WebSocket.recv" class="classattr">
                                        <input id="WebSocket.recv-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">recv</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="WebSocket.recv-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.recv"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.recv-387"><a href="#WebSocket.recv-387"><span class="linenos">387</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recv</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
</span><span id="WebSocket.recv-388"><a href="#WebSocket.recv-388"><span class="linenos">388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.recv-389"><a href="#WebSocket.recv-389"><span class="linenos">389</span></a><span class="sd">        Receive string data(byte array) from the server.</span>
</span><span id="WebSocket.recv-390"><a href="#WebSocket.recv-390"><span class="linenos">390</span></a>
</span><span id="WebSocket.recv-391"><a href="#WebSocket.recv-391"><span class="linenos">391</span></a><span class="sd">        Returns</span>
</span><span id="WebSocket.recv-392"><a href="#WebSocket.recv-392"><span class="linenos">392</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.recv-393"><a href="#WebSocket.recv-393"><span class="linenos">393</span></a><span class="sd">        data: string (byte array) value.</span>
</span><span id="WebSocket.recv-394"><a href="#WebSocket.recv-394"><span class="linenos">394</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.recv-395"><a href="#WebSocket.recv-395"><span class="linenos">395</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">readlock</span><span class="p">:</span>
</span><span id="WebSocket.recv-396"><a href="#WebSocket.recv-396"><span class="linenos">396</span></a>            <span class="n">opcode</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_data</span><span class="p">()</span>
</span><span id="WebSocket.recv-397"><a href="#WebSocket.recv-397"><span class="linenos">397</span></a>        <span class="k">if</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_TEXT</span><span class="p">:</span>
</span><span id="WebSocket.recv-398"><a href="#WebSocket.recv-398"><span class="linenos">398</span></a>            <span class="n">data_received</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="WebSocket.recv-399"><a href="#WebSocket.recv-399"><span class="linenos">399</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_received</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="WebSocket.recv-400"><a href="#WebSocket.recv-400"><span class="linenos">400</span></a>                <span class="k">return</span> <span class="n">data_received</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="WebSocket.recv-401"><a href="#WebSocket.recv-401"><span class="linenos">401</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_received</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="WebSocket.recv-402"><a href="#WebSocket.recv-402"><span class="linenos">402</span></a>                <span class="k">return</span> <span class="n">data_received</span>
</span><span id="WebSocket.recv-403"><a href="#WebSocket.recv-403"><span class="linenos">403</span></a>        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_BINARY</span><span class="p">:</span>
</span><span id="WebSocket.recv-404"><a href="#WebSocket.recv-404"><span class="linenos">404</span></a>            <span class="n">data_binary</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="WebSocket.recv-405"><a href="#WebSocket.recv-405"><span class="linenos">405</span></a>            <span class="k">return</span> <span class="n">data_binary</span>
</span><span id="WebSocket.recv-406"><a href="#WebSocket.recv-406"><span class="linenos">406</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket.recv-407"><a href="#WebSocket.recv-407"><span class="linenos">407</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Receive string data(byte array) from the server.</p>

<h2 id="returns">Returns</h2>

<p>data: string (byte array) value.</p>
</div>


                            </div>
                            <div id="WebSocket.recv_data" class="classattr">
                                        <input id="WebSocket.recv_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">recv_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">control_frame</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="WebSocket.recv_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.recv_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.recv_data-409"><a href="#WebSocket.recv_data-409"><span class="linenos">409</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recv_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_frame</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="WebSocket.recv_data-410"><a href="#WebSocket.recv_data-410"><span class="linenos">410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.recv_data-411"><a href="#WebSocket.recv_data-411"><span class="linenos">411</span></a><span class="sd">        Receive data with operation code.</span>
</span><span id="WebSocket.recv_data-412"><a href="#WebSocket.recv_data-412"><span class="linenos">412</span></a>
</span><span id="WebSocket.recv_data-413"><a href="#WebSocket.recv_data-413"><span class="linenos">413</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket.recv_data-414"><a href="#WebSocket.recv_data-414"><span class="linenos">414</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.recv_data-415"><a href="#WebSocket.recv_data-415"><span class="linenos">415</span></a><span class="sd">        control_frame: bool</span>
</span><span id="WebSocket.recv_data-416"><a href="#WebSocket.recv_data-416"><span class="linenos">416</span></a><span class="sd">            a boolean flag indicating whether to return control frame</span>
</span><span id="WebSocket.recv_data-417"><a href="#WebSocket.recv_data-417"><span class="linenos">417</span></a><span class="sd">            data, defaults to False</span>
</span><span id="WebSocket.recv_data-418"><a href="#WebSocket.recv_data-418"><span class="linenos">418</span></a>
</span><span id="WebSocket.recv_data-419"><a href="#WebSocket.recv_data-419"><span class="linenos">419</span></a><span class="sd">        Returns</span>
</span><span id="WebSocket.recv_data-420"><a href="#WebSocket.recv_data-420"><span class="linenos">420</span></a><span class="sd">        -------</span>
</span><span id="WebSocket.recv_data-421"><a href="#WebSocket.recv_data-421"><span class="linenos">421</span></a><span class="sd">        opcode, frame.data: tuple</span>
</span><span id="WebSocket.recv_data-422"><a href="#WebSocket.recv_data-422"><span class="linenos">422</span></a><span class="sd">            tuple of operation code and string(byte array) value.</span>
</span><span id="WebSocket.recv_data-423"><a href="#WebSocket.recv_data-423"><span class="linenos">423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.recv_data-424"><a href="#WebSocket.recv_data-424"><span class="linenos">424</span></a>        <span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_data_frame</span><span class="p">(</span><span class="n">control_frame</span><span class="p">)</span>
</span><span id="WebSocket.recv_data-425"><a href="#WebSocket.recv_data-425"><span class="linenos">425</span></a>        <span class="k">return</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">data</span>
</span></pre></div>


            <div class="docstring"><p>Receive data with operation code.</p>

<h2 id="parameters">Parameters</h2>

<p>control_frame: bool
    a boolean flag indicating whether to return control frame
    data, defaults to False</p>

<h2 id="returns">Returns</h2>

<p>opcode, frame.data: tuple
    tuple of operation code and string(byte array) value.</p>
</div>


                            </div>
                            <div id="WebSocket.recv_data_frame" class="classattr">
                                        <input id="WebSocket.recv_data_frame-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">recv_data_frame</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">control_frame</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="WebSocket.recv_data_frame-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.recv_data_frame"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.recv_data_frame-427"><a href="#WebSocket.recv_data_frame-427"><span class="linenos">427</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recv_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_frame</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="WebSocket.recv_data_frame-428"><a href="#WebSocket.recv_data_frame-428"><span class="linenos">428</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.recv_data_frame-429"><a href="#WebSocket.recv_data_frame-429"><span class="linenos">429</span></a><span class="sd">        Receive data with operation code.</span>
</span><span id="WebSocket.recv_data_frame-430"><a href="#WebSocket.recv_data_frame-430"><span class="linenos">430</span></a>
</span><span id="WebSocket.recv_data_frame-431"><a href="#WebSocket.recv_data_frame-431"><span class="linenos">431</span></a><span class="sd">        If a valid ping message is received, a pong response is sent.</span>
</span><span id="WebSocket.recv_data_frame-432"><a href="#WebSocket.recv_data_frame-432"><span class="linenos">432</span></a>
</span><span id="WebSocket.recv_data_frame-433"><a href="#WebSocket.recv_data_frame-433"><span class="linenos">433</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket.recv_data_frame-434"><a href="#WebSocket.recv_data_frame-434"><span class="linenos">434</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.recv_data_frame-435"><a href="#WebSocket.recv_data_frame-435"><span class="linenos">435</span></a><span class="sd">        control_frame: bool</span>
</span><span id="WebSocket.recv_data_frame-436"><a href="#WebSocket.recv_data_frame-436"><span class="linenos">436</span></a><span class="sd">            a boolean flag indicating whether to return control frame</span>
</span><span id="WebSocket.recv_data_frame-437"><a href="#WebSocket.recv_data_frame-437"><span class="linenos">437</span></a><span class="sd">            data, defaults to False</span>
</span><span id="WebSocket.recv_data_frame-438"><a href="#WebSocket.recv_data_frame-438"><span class="linenos">438</span></a>
</span><span id="WebSocket.recv_data_frame-439"><a href="#WebSocket.recv_data_frame-439"><span class="linenos">439</span></a><span class="sd">        Returns</span>
</span><span id="WebSocket.recv_data_frame-440"><a href="#WebSocket.recv_data_frame-440"><span class="linenos">440</span></a><span class="sd">        -------</span>
</span><span id="WebSocket.recv_data_frame-441"><a href="#WebSocket.recv_data_frame-441"><span class="linenos">441</span></a><span class="sd">        frame.opcode, frame: tuple</span>
</span><span id="WebSocket.recv_data_frame-442"><a href="#WebSocket.recv_data_frame-442"><span class="linenos">442</span></a><span class="sd">            tuple of operation code and string(byte array) value.</span>
</span><span id="WebSocket.recv_data_frame-443"><a href="#WebSocket.recv_data_frame-443"><span class="linenos">443</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.recv_data_frame-444"><a href="#WebSocket.recv_data_frame-444"><span class="linenos">444</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="WebSocket.recv_data_frame-445"><a href="#WebSocket.recv_data_frame-445"><span class="linenos">445</span></a>            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_frame</span><span class="p">()</span>
</span><span id="WebSocket.recv_data_frame-446"><a href="#WebSocket.recv_data_frame-446"><span class="linenos">446</span></a>            <span class="k">if</span> <span class="n">isEnabledForTrace</span><span class="p">():</span>
</span><span id="WebSocket.recv_data_frame-447"><a href="#WebSocket.recv_data_frame-447"><span class="linenos">447</span></a>                <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;++Rcv raw: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">format</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WebSocket.recv_data_frame-448"><a href="#WebSocket.recv_data_frame-448"><span class="linenos">448</span></a>                <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;++Rcv decoded: </span><span class="si">{</span><span class="n">frame</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WebSocket.recv_data_frame-449"><a href="#WebSocket.recv_data_frame-449"><span class="linenos">449</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">frame</span><span class="p">:</span>
</span><span id="WebSocket.recv_data_frame-450"><a href="#WebSocket.recv_data_frame-450"><span class="linenos">450</span></a>                <span class="c1"># handle error:</span>
</span><span id="WebSocket.recv_data_frame-451"><a href="#WebSocket.recv_data_frame-451"><span class="linenos">451</span></a>                <span class="c1"># &#39;NoneType&#39; object has no attribute &#39;opcode&#39;</span>
</span><span id="WebSocket.recv_data_frame-452"><a href="#WebSocket.recv_data_frame-452"><span class="linenos">452</span></a>                <span class="k">raise</span> <span class="n">WebSocketProtocolException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not a valid frame </span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WebSocket.recv_data_frame-453"><a href="#WebSocket.recv_data_frame-453"><span class="linenos">453</span></a>            <span class="k">elif</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="ow">in</span> <span class="p">(</span>
</span><span id="WebSocket.recv_data_frame-454"><a href="#WebSocket.recv_data_frame-454"><span class="linenos">454</span></a>                <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_TEXT</span><span class="p">,</span>
</span><span id="WebSocket.recv_data_frame-455"><a href="#WebSocket.recv_data_frame-455"><span class="linenos">455</span></a>                <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_BINARY</span><span class="p">,</span>
</span><span id="WebSocket.recv_data_frame-456"><a href="#WebSocket.recv_data_frame-456"><span class="linenos">456</span></a>                <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CONT</span><span class="p">,</span>
</span><span id="WebSocket.recv_data_frame-457"><a href="#WebSocket.recv_data_frame-457"><span class="linenos">457</span></a>            <span class="p">):</span>
</span><span id="WebSocket.recv_data_frame-458"><a href="#WebSocket.recv_data_frame-458"><span class="linenos">458</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="WebSocket.recv_data_frame-459"><a href="#WebSocket.recv_data_frame-459"><span class="linenos">459</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="WebSocket.recv_data_frame-460"><a href="#WebSocket.recv_data_frame-460"><span class="linenos">460</span></a>
</span><span id="WebSocket.recv_data_frame-461"><a href="#WebSocket.recv_data_frame-461"><span class="linenos">461</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span><span class="o">.</span><span class="n">is_fire</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
</span><span id="WebSocket.recv_data_frame-462"><a href="#WebSocket.recv_data_frame-462"><span class="linenos">462</span></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cont_frame</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="WebSocket.recv_data_frame-463"><a href="#WebSocket.recv_data_frame-463"><span class="linenos">463</span></a>
</span><span id="WebSocket.recv_data_frame-464"><a href="#WebSocket.recv_data_frame-464"><span class="linenos">464</span></a>            <span class="k">elif</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CLOSE</span><span class="p">:</span>
</span><span id="WebSocket.recv_data_frame-465"><a href="#WebSocket.recv_data_frame-465"><span class="linenos">465</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">send_close</span><span class="p">()</span>
</span><span id="WebSocket.recv_data_frame-466"><a href="#WebSocket.recv_data_frame-466"><span class="linenos">466</span></a>                <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span>
</span><span id="WebSocket.recv_data_frame-467"><a href="#WebSocket.recv_data_frame-467"><span class="linenos">467</span></a>            <span class="k">elif</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_PING</span><span class="p">:</span>
</span><span id="WebSocket.recv_data_frame-468"><a href="#WebSocket.recv_data_frame-468"><span class="linenos">468</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">126</span><span class="p">:</span>
</span><span id="WebSocket.recv_data_frame-469"><a href="#WebSocket.recv_data_frame-469"><span class="linenos">469</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pong</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="WebSocket.recv_data_frame-470"><a href="#WebSocket.recv_data_frame-470"><span class="linenos">470</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="WebSocket.recv_data_frame-471"><a href="#WebSocket.recv_data_frame-471"><span class="linenos">471</span></a>                    <span class="k">raise</span> <span class="n">WebSocketProtocolException</span><span class="p">(</span><span class="s2">&quot;Ping message is too long&quot;</span><span class="p">)</span>
</span><span id="WebSocket.recv_data_frame-472"><a href="#WebSocket.recv_data_frame-472"><span class="linenos">472</span></a>                <span class="k">if</span> <span class="n">control_frame</span><span class="p">:</span>
</span><span id="WebSocket.recv_data_frame-473"><a href="#WebSocket.recv_data_frame-473"><span class="linenos">473</span></a>                    <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span>
</span><span id="WebSocket.recv_data_frame-474"><a href="#WebSocket.recv_data_frame-474"><span class="linenos">474</span></a>            <span class="k">elif</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_PONG</span><span class="p">:</span>
</span><span id="WebSocket.recv_data_frame-475"><a href="#WebSocket.recv_data_frame-475"><span class="linenos">475</span></a>                <span class="k">if</span> <span class="n">control_frame</span><span class="p">:</span>
</span><span id="WebSocket.recv_data_frame-476"><a href="#WebSocket.recv_data_frame-476"><span class="linenos">476</span></a>                    <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span><span class="p">,</span> <span class="n">frame</span>
</span></pre></div>


            <div class="docstring"><p>Receive data with operation code.</p>

<p>If a valid ping message is received, a pong response is sent.</p>

<h2 id="parameters">Parameters</h2>

<p>control_frame: bool
    a boolean flag indicating whether to return control frame
    data, defaults to False</p>

<h2 id="returns">Returns</h2>

<p>frame.opcode, frame: tuple
    tuple of operation code and string(byte array) value.</p>
</div>


                            </div>
                            <div id="WebSocket.recv_frame" class="classattr">
                                        <input id="WebSocket.recv_frame-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">recv_frame</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.recv_frame-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.recv_frame"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.recv_frame-478"><a href="#WebSocket.recv_frame-478"><span class="linenos">478</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recv_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket.recv_frame-479"><a href="#WebSocket.recv_frame-479"><span class="linenos">479</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.recv_frame-480"><a href="#WebSocket.recv_frame-480"><span class="linenos">480</span></a><span class="sd">        Receive data as frame from server.</span>
</span><span id="WebSocket.recv_frame-481"><a href="#WebSocket.recv_frame-481"><span class="linenos">481</span></a>
</span><span id="WebSocket.recv_frame-482"><a href="#WebSocket.recv_frame-482"><span class="linenos">482</span></a><span class="sd">        Returns</span>
</span><span id="WebSocket.recv_frame-483"><a href="#WebSocket.recv_frame-483"><span class="linenos">483</span></a><span class="sd">        -------</span>
</span><span id="WebSocket.recv_frame-484"><a href="#WebSocket.recv_frame-484"><span class="linenos">484</span></a><span class="sd">        self.frame_buffer.recv_frame(): ABNF frame object</span>
</span><span id="WebSocket.recv_frame-485"><a href="#WebSocket.recv_frame-485"><span class="linenos">485</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.recv_frame-486"><a href="#WebSocket.recv_frame-486"><span class="linenos">486</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_buffer</span><span class="o">.</span><span class="n">recv_frame</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Receive data as frame from server.</p>

<h2 id="returns">Returns</h2>

<p>self.frame_buffer.recv_frame(): ABNF frame object</p>
</div>


                            </div>
                            <div id="WebSocket.send_close" class="classattr">
                                        <input id="WebSocket.send_close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">send_close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">status</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>, </span><span class="param"><span class="n">reason</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.send_close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.send_close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.send_close-488"><a href="#WebSocket.send_close-488"><span class="linenos">488</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">STATUS_NORMAL</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="WebSocket.send_close-489"><a href="#WebSocket.send_close-489"><span class="linenos">489</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.send_close-490"><a href="#WebSocket.send_close-490"><span class="linenos">490</span></a><span class="sd">        Send close data to the server.</span>
</span><span id="WebSocket.send_close-491"><a href="#WebSocket.send_close-491"><span class="linenos">491</span></a>
</span><span id="WebSocket.send_close-492"><a href="#WebSocket.send_close-492"><span class="linenos">492</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket.send_close-493"><a href="#WebSocket.send_close-493"><span class="linenos">493</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.send_close-494"><a href="#WebSocket.send_close-494"><span class="linenos">494</span></a><span class="sd">        status: int</span>
</span><span id="WebSocket.send_close-495"><a href="#WebSocket.send_close-495"><span class="linenos">495</span></a><span class="sd">            Status code to send. See STATUS_XXX.</span>
</span><span id="WebSocket.send_close-496"><a href="#WebSocket.send_close-496"><span class="linenos">496</span></a><span class="sd">        reason: str or bytes</span>
</span><span id="WebSocket.send_close-497"><a href="#WebSocket.send_close-497"><span class="linenos">497</span></a><span class="sd">            The reason to close. This must be string or UTF-8 bytes.</span>
</span><span id="WebSocket.send_close-498"><a href="#WebSocket.send_close-498"><span class="linenos">498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.send_close-499"><a href="#WebSocket.send_close-499"><span class="linenos">499</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">&gt;=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">LENGTH_16</span><span class="p">:</span>
</span><span id="WebSocket.send_close-500"><a href="#WebSocket.send_close-500"><span class="linenos">500</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;code is invalid range&quot;</span><span class="p">)</span>
</span><span id="WebSocket.send_close-501"><a href="#WebSocket.send_close-501"><span class="linenos">501</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="WebSocket.send_close-502"><a href="#WebSocket.send_close-502"><span class="linenos">502</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;!H&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span> <span class="o">+</span> <span class="n">reason</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CLOSE</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Send close data to the server.</p>

<h2 id="parameters">Parameters</h2>

<p>status: int
    Status code to send. See STATUS_XXX.
reason: str or bytes
    The reason to close. This must be string or UTF-8 bytes.</p>
</div>


                            </div>
                            <div id="WebSocket.close" class="classattr">
                                        <input id="WebSocket.close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">status</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>, </span><span class="param"><span class="n">reason</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>, </span><span class="param"><span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.close-504"><a href="#WebSocket.close-504"><span class="linenos">504</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">STATUS_NORMAL</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
</span><span id="WebSocket.close-505"><a href="#WebSocket.close-505"><span class="linenos">505</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.close-506"><a href="#WebSocket.close-506"><span class="linenos">506</span></a><span class="sd">        Close Websocket object</span>
</span><span id="WebSocket.close-507"><a href="#WebSocket.close-507"><span class="linenos">507</span></a>
</span><span id="WebSocket.close-508"><a href="#WebSocket.close-508"><span class="linenos">508</span></a><span class="sd">        Parameters</span>
</span><span id="WebSocket.close-509"><a href="#WebSocket.close-509"><span class="linenos">509</span></a><span class="sd">        ----------</span>
</span><span id="WebSocket.close-510"><a href="#WebSocket.close-510"><span class="linenos">510</span></a><span class="sd">        status: int</span>
</span><span id="WebSocket.close-511"><a href="#WebSocket.close-511"><span class="linenos">511</span></a><span class="sd">            Status code to send. See VALID_CLOSE_STATUS in ABNF.</span>
</span><span id="WebSocket.close-512"><a href="#WebSocket.close-512"><span class="linenos">512</span></a><span class="sd">        reason: bytes</span>
</span><span id="WebSocket.close-513"><a href="#WebSocket.close-513"><span class="linenos">513</span></a><span class="sd">            The reason to close in UTF-8.</span>
</span><span id="WebSocket.close-514"><a href="#WebSocket.close-514"><span class="linenos">514</span></a><span class="sd">        timeout: int or float</span>
</span><span id="WebSocket.close-515"><a href="#WebSocket.close-515"><span class="linenos">515</span></a><span class="sd">            Timeout until receive a close frame.</span>
</span><span id="WebSocket.close-516"><a href="#WebSocket.close-516"><span class="linenos">516</span></a><span class="sd">            If None, it will wait forever until receive a close frame.</span>
</span><span id="WebSocket.close-517"><a href="#WebSocket.close-517"><span class="linenos">517</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.close-518"><a href="#WebSocket.close-518"><span class="linenos">518</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="WebSocket.close-519"><a href="#WebSocket.close-519"><span class="linenos">519</span></a>            <span class="k">return</span>
</span><span id="WebSocket.close-520"><a href="#WebSocket.close-520"><span class="linenos">520</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">&gt;=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">LENGTH_16</span><span class="p">:</span>
</span><span id="WebSocket.close-521"><a href="#WebSocket.close-521"><span class="linenos">521</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;code is invalid range&quot;</span><span class="p">)</span>
</span><span id="WebSocket.close-522"><a href="#WebSocket.close-522"><span class="linenos">522</span></a>
</span><span id="WebSocket.close-523"><a href="#WebSocket.close-523"><span class="linenos">523</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="WebSocket.close-524"><a href="#WebSocket.close-524"><span class="linenos">524</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="WebSocket.close-525"><a href="#WebSocket.close-525"><span class="linenos">525</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;!H&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span> <span class="o">+</span> <span class="n">reason</span><span class="p">,</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CLOSE</span><span class="p">)</span>
</span><span id="WebSocket.close-526"><a href="#WebSocket.close-526"><span class="linenos">526</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WebSocket.close-527"><a href="#WebSocket.close-527"><span class="linenos">527</span></a>                <span class="k">return</span>
</span><span id="WebSocket.close-528"><a href="#WebSocket.close-528"><span class="linenos">528</span></a>            <span class="n">sock_timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">gettimeout</span><span class="p">()</span>
</span><span id="WebSocket.close-529"><a href="#WebSocket.close-529"><span class="linenos">529</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="WebSocket.close-530"><a href="#WebSocket.close-530"><span class="linenos">530</span></a>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="WebSocket.close-531"><a href="#WebSocket.close-531"><span class="linenos">531</span></a>            <span class="k">while</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="WebSocket.close-532"><a href="#WebSocket.close-532"><span class="linenos">532</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="WebSocket.close-533"><a href="#WebSocket.close-533"><span class="linenos">533</span></a>                    <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_frame</span><span class="p">()</span>
</span><span id="WebSocket.close-534"><a href="#WebSocket.close-534"><span class="linenos">534</span></a>                    <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">opcode</span> <span class="o">!=</span> <span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_CLOSE</span><span class="p">:</span>
</span><span id="WebSocket.close-535"><a href="#WebSocket.close-535"><span class="linenos">535</span></a>                        <span class="k">continue</span>
</span><span id="WebSocket.close-536"><a href="#WebSocket.close-536"><span class="linenos">536</span></a>                    <span class="k">if</span> <span class="n">isEnabledForError</span><span class="p">():</span>
</span><span id="WebSocket.close-537"><a href="#WebSocket.close-537"><span class="linenos">537</span></a>                        <span class="n">recv_status</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;!H&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WebSocket.close-538"><a href="#WebSocket.close-538"><span class="linenos">538</span></a>                        <span class="k">if</span> <span class="n">recv_status</span> <span class="o">&gt;=</span> <span class="mi">3000</span> <span class="ow">and</span> <span class="n">recv_status</span> <span class="o">&lt;=</span> <span class="mi">4999</span><span class="p">:</span>
</span><span id="WebSocket.close-539"><a href="#WebSocket.close-539"><span class="linenos">539</span></a>                            <span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;close status: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">recv_status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WebSocket.close-540"><a href="#WebSocket.close-540"><span class="linenos">540</span></a>                        <span class="k">elif</span> <span class="n">recv_status</span> <span class="o">!=</span> <span class="n">STATUS_NORMAL</span><span class="p">:</span>
</span><span id="WebSocket.close-541"><a href="#WebSocket.close-541"><span class="linenos">541</span></a>                            <span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;close status: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">recv_status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WebSocket.close-542"><a href="#WebSocket.close-542"><span class="linenos">542</span></a>                    <span class="k">break</span>
</span><span id="WebSocket.close-543"><a href="#WebSocket.close-543"><span class="linenos">543</span></a>                <span class="k">except</span> <span class="p">(</span>
</span><span id="WebSocket.close-544"><a href="#WebSocket.close-544"><span class="linenos">544</span></a>                    <span class="n">WebSocketConnectionClosedException</span><span class="p">,</span>
</span><span id="WebSocket.close-545"><a href="#WebSocket.close-545"><span class="linenos">545</span></a>                    <span class="n">WebSocketTimeoutException</span><span class="p">,</span>
</span><span id="WebSocket.close-546"><a href="#WebSocket.close-546"><span class="linenos">546</span></a>                    <span class="n">struct</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
</span><span id="WebSocket.close-547"><a href="#WebSocket.close-547"><span class="linenos">547</span></a>                <span class="p">):</span>
</span><span id="WebSocket.close-548"><a href="#WebSocket.close-548"><span class="linenos">548</span></a>                    <span class="k">break</span>
</span><span id="WebSocket.close-549"><a href="#WebSocket.close-549"><span class="linenos">549</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WebSocket.close-550"><a href="#WebSocket.close-550"><span class="linenos">550</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">sock_timeout</span><span class="p">)</span>
</span><span id="WebSocket.close-551"><a href="#WebSocket.close-551"><span class="linenos">551</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_RDWR</span><span class="p">)</span>
</span><span id="WebSocket.close-552"><a href="#WebSocket.close-552"><span class="linenos">552</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="WebSocket.close-553"><a href="#WebSocket.close-553"><span class="linenos">553</span></a>            <span class="k">pass</span>
</span><span id="WebSocket.close-554"><a href="#WebSocket.close-554"><span class="linenos">554</span></a>
</span><span id="WebSocket.close-555"><a href="#WebSocket.close-555"><span class="linenos">555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Close Websocket object</p>

<h2 id="parameters">Parameters</h2>

<p>status: int
    Status code to send. See VALID_CLOSE_STATUS in ABNF.
reason: bytes
    The reason to close in UTF-8.
timeout: int or float
    Timeout until receive a close frame.
    If None, it will wait forever until receive a close frame.</p>
</div>


                            </div>
                            <div id="WebSocket.abort" class="classattr">
                                        <input id="WebSocket.abort-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">abort</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.abort-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.abort"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.abort-557"><a href="#WebSocket.abort-557"><span class="linenos">557</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket.abort-558"><a href="#WebSocket.abort-558"><span class="linenos">558</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.abort-559"><a href="#WebSocket.abort-559"><span class="linenos">559</span></a><span class="sd">        Low-level asynchronous abort, wakes up other threads that are waiting in recv_*</span>
</span><span id="WebSocket.abort-560"><a href="#WebSocket.abort-560"><span class="linenos">560</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.abort-561"><a href="#WebSocket.abort-561"><span class="linenos">561</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="WebSocket.abort-562"><a href="#WebSocket.abort-562"><span class="linenos">562</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_RDWR</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Low-level asynchronous abort, wakes up other threads that are waiting in recv_*</p>
</div>


                            </div>
                            <div id="WebSocket.shutdown" class="classattr">
                                        <input id="WebSocket.shutdown-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">shutdown</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WebSocket.shutdown-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WebSocket.shutdown"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WebSocket.shutdown-564"><a href="#WebSocket.shutdown-564"><span class="linenos">564</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WebSocket.shutdown-565"><a href="#WebSocket.shutdown-565"><span class="linenos">565</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WebSocket.shutdown-566"><a href="#WebSocket.shutdown-566"><span class="linenos">566</span></a><span class="sd">        close socket, immediately.</span>
</span><span id="WebSocket.shutdown-567"><a href="#WebSocket.shutdown-567"><span class="linenos">567</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WebSocket.shutdown-568"><a href="#WebSocket.shutdown-568"><span class="linenos">568</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span>
</span><span id="WebSocket.shutdown-569"><a href="#WebSocket.shutdown-569"><span class="linenos">569</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="WebSocket.shutdown-570"><a href="#WebSocket.shutdown-570"><span class="linenos">570</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WebSocket.shutdown-571"><a href="#WebSocket.shutdown-571"><span class="linenos">571</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>close socket, immediately.</p>
</div>


                            </div>
                </section>
                <section id="create_connection">
                            <input id="create_connection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_connection</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">url</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">timeout</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	class_=&lt;class &#x27;<a href="#WebSocket">WebSocket</a>&#x27;&gt;,</span><span class="param">	<span class="o">**</span><span class="n">options</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="create_connection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#create_connection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="create_connection-591"><a href="#create_connection-591"><span class="linenos">591</span></a><span class="k">def</span><span class="w"> </span><span class="nf">create_connection</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="n">WebSocket</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="create_connection-592"><a href="#create_connection-592"><span class="linenos">592</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="create_connection-593"><a href="#create_connection-593"><span class="linenos">593</span></a><span class="sd">    Connect to url and return websocket object.</span>
</span><span id="create_connection-594"><a href="#create_connection-594"><span class="linenos">594</span></a>
</span><span id="create_connection-595"><a href="#create_connection-595"><span class="linenos">595</span></a><span class="sd">    Connect to url and return the WebSocket object.</span>
</span><span id="create_connection-596"><a href="#create_connection-596"><span class="linenos">596</span></a><span class="sd">    Passing optional timeout parameter will set the timeout on the socket.</span>
</span><span id="create_connection-597"><a href="#create_connection-597"><span class="linenos">597</span></a><span class="sd">    If no timeout is supplied,</span>
</span><span id="create_connection-598"><a href="#create_connection-598"><span class="linenos">598</span></a><span class="sd">    the global default timeout setting returned by getdefaulttimeout() is used.</span>
</span><span id="create_connection-599"><a href="#create_connection-599"><span class="linenos">599</span></a><span class="sd">    You can customize using &#39;options&#39;.</span>
</span><span id="create_connection-600"><a href="#create_connection-600"><span class="linenos">600</span></a><span class="sd">    If you set &quot;header&quot; list object, you can set your own custom header.</span>
</span><span id="create_connection-601"><a href="#create_connection-601"><span class="linenos">601</span></a>
</span><span id="create_connection-602"><a href="#create_connection-602"><span class="linenos">602</span></a><span class="sd">    &gt;&gt;&gt; conn = create_connection(&quot;ws://echo.websocket.events&quot;,</span>
</span><span id="create_connection-603"><a href="#create_connection-603"><span class="linenos">603</span></a><span class="sd">         ...     header=[&quot;User-Agent: MyProgram&quot;,</span>
</span><span id="create_connection-604"><a href="#create_connection-604"><span class="linenos">604</span></a><span class="sd">         ...             &quot;x-custom: header&quot;])</span>
</span><span id="create_connection-605"><a href="#create_connection-605"><span class="linenos">605</span></a>
</span><span id="create_connection-606"><a href="#create_connection-606"><span class="linenos">606</span></a><span class="sd">    Parameters</span>
</span><span id="create_connection-607"><a href="#create_connection-607"><span class="linenos">607</span></a><span class="sd">    ----------</span>
</span><span id="create_connection-608"><a href="#create_connection-608"><span class="linenos">608</span></a><span class="sd">    class_: class</span>
</span><span id="create_connection-609"><a href="#create_connection-609"><span class="linenos">609</span></a><span class="sd">        class to instantiate when creating the connection. It has to implement</span>
</span><span id="create_connection-610"><a href="#create_connection-610"><span class="linenos">610</span></a><span class="sd">        settimeout and connect. It&#39;s __init__ should be compatible with</span>
</span><span id="create_connection-611"><a href="#create_connection-611"><span class="linenos">611</span></a><span class="sd">        WebSocket.__init__, i.e. accept all of it&#39;s kwargs.</span>
</span><span id="create_connection-612"><a href="#create_connection-612"><span class="linenos">612</span></a><span class="sd">    header: list or dict</span>
</span><span id="create_connection-613"><a href="#create_connection-613"><span class="linenos">613</span></a><span class="sd">        custom http header list or dict.</span>
</span><span id="create_connection-614"><a href="#create_connection-614"><span class="linenos">614</span></a><span class="sd">    cookie: str</span>
</span><span id="create_connection-615"><a href="#create_connection-615"><span class="linenos">615</span></a><span class="sd">        Cookie value.</span>
</span><span id="create_connection-616"><a href="#create_connection-616"><span class="linenos">616</span></a><span class="sd">    origin: str</span>
</span><span id="create_connection-617"><a href="#create_connection-617"><span class="linenos">617</span></a><span class="sd">        custom origin url.</span>
</span><span id="create_connection-618"><a href="#create_connection-618"><span class="linenos">618</span></a><span class="sd">    suppress_origin: bool</span>
</span><span id="create_connection-619"><a href="#create_connection-619"><span class="linenos">619</span></a><span class="sd">        suppress outputting origin header.</span>
</span><span id="create_connection-620"><a href="#create_connection-620"><span class="linenos">620</span></a><span class="sd">    host: str</span>
</span><span id="create_connection-621"><a href="#create_connection-621"><span class="linenos">621</span></a><span class="sd">        custom host header string.</span>
</span><span id="create_connection-622"><a href="#create_connection-622"><span class="linenos">622</span></a><span class="sd">    timeout: int or float</span>
</span><span id="create_connection-623"><a href="#create_connection-623"><span class="linenos">623</span></a><span class="sd">        socket timeout time. This value could be either float/integer.</span>
</span><span id="create_connection-624"><a href="#create_connection-624"><span class="linenos">624</span></a><span class="sd">        If set to None, it uses the default_timeout value.</span>
</span><span id="create_connection-625"><a href="#create_connection-625"><span class="linenos">625</span></a><span class="sd">    http_proxy_host: str</span>
</span><span id="create_connection-626"><a href="#create_connection-626"><span class="linenos">626</span></a><span class="sd">        HTTP proxy host name.</span>
</span><span id="create_connection-627"><a href="#create_connection-627"><span class="linenos">627</span></a><span class="sd">    http_proxy_port: str or int</span>
</span><span id="create_connection-628"><a href="#create_connection-628"><span class="linenos">628</span></a><span class="sd">        HTTP proxy port. If not set, set to 80.</span>
</span><span id="create_connection-629"><a href="#create_connection-629"><span class="linenos">629</span></a><span class="sd">    http_no_proxy: list</span>
</span><span id="create_connection-630"><a href="#create_connection-630"><span class="linenos">630</span></a><span class="sd">        Whitelisted host names that don&#39;t use the proxy.</span>
</span><span id="create_connection-631"><a href="#create_connection-631"><span class="linenos">631</span></a><span class="sd">    http_proxy_auth: tuple</span>
</span><span id="create_connection-632"><a href="#create_connection-632"><span class="linenos">632</span></a><span class="sd">        HTTP proxy auth information. tuple of username and password. Default is None.</span>
</span><span id="create_connection-633"><a href="#create_connection-633"><span class="linenos">633</span></a><span class="sd">    http_proxy_timeout: int or float</span>
</span><span id="create_connection-634"><a href="#create_connection-634"><span class="linenos">634</span></a><span class="sd">        HTTP proxy timeout, default is 60 sec as per python-socks.</span>
</span><span id="create_connection-635"><a href="#create_connection-635"><span class="linenos">635</span></a><span class="sd">    enable_multithread: bool</span>
</span><span id="create_connection-636"><a href="#create_connection-636"><span class="linenos">636</span></a><span class="sd">        Enable lock for multithread.</span>
</span><span id="create_connection-637"><a href="#create_connection-637"><span class="linenos">637</span></a><span class="sd">    redirect_limit: int</span>
</span><span id="create_connection-638"><a href="#create_connection-638"><span class="linenos">638</span></a><span class="sd">        Number of redirects to follow.</span>
</span><span id="create_connection-639"><a href="#create_connection-639"><span class="linenos">639</span></a><span class="sd">    sockopt: tuple</span>
</span><span id="create_connection-640"><a href="#create_connection-640"><span class="linenos">640</span></a><span class="sd">        Values for socket.setsockopt.</span>
</span><span id="create_connection-641"><a href="#create_connection-641"><span class="linenos">641</span></a><span class="sd">        sockopt must be a tuple and each element is an argument of sock.setsockopt.</span>
</span><span id="create_connection-642"><a href="#create_connection-642"><span class="linenos">642</span></a><span class="sd">    sslopt: dict</span>
</span><span id="create_connection-643"><a href="#create_connection-643"><span class="linenos">643</span></a><span class="sd">        Optional dict object for ssl socket options. See FAQ for details.</span>
</span><span id="create_connection-644"><a href="#create_connection-644"><span class="linenos">644</span></a><span class="sd">    subprotocols: list</span>
</span><span id="create_connection-645"><a href="#create_connection-645"><span class="linenos">645</span></a><span class="sd">        List of available subprotocols. Default is None.</span>
</span><span id="create_connection-646"><a href="#create_connection-646"><span class="linenos">646</span></a><span class="sd">    skip_utf8_validation: bool</span>
</span><span id="create_connection-647"><a href="#create_connection-647"><span class="linenos">647</span></a><span class="sd">        Skip utf8 validation.</span>
</span><span id="create_connection-648"><a href="#create_connection-648"><span class="linenos">648</span></a><span class="sd">    socket: socket</span>
</span><span id="create_connection-649"><a href="#create_connection-649"><span class="linenos">649</span></a><span class="sd">        Pre-initialized stream socket.</span>
</span><span id="create_connection-650"><a href="#create_connection-650"><span class="linenos">650</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="create_connection-651"><a href="#create_connection-651"><span class="linenos">651</span></a>    <span class="n">sockopt</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;sockopt&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="create_connection-652"><a href="#create_connection-652"><span class="linenos">652</span></a>    <span class="n">sslopt</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;sslopt&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="create_connection-653"><a href="#create_connection-653"><span class="linenos">653</span></a>    <span class="n">fire_cont_frame</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fire_cont_frame&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="create_connection-654"><a href="#create_connection-654"><span class="linenos">654</span></a>    <span class="n">enable_multithread</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;enable_multithread&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="create_connection-655"><a href="#create_connection-655"><span class="linenos">655</span></a>    <span class="n">skip_utf8_validation</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;skip_utf8_validation&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="create_connection-656"><a href="#create_connection-656"><span class="linenos">656</span></a>    <span class="n">websock</span> <span class="o">=</span> <span class="n">class_</span><span class="p">(</span>
</span><span id="create_connection-657"><a href="#create_connection-657"><span class="linenos">657</span></a>        <span class="n">sockopt</span><span class="o">=</span><span class="n">sockopt</span><span class="p">,</span>
</span><span id="create_connection-658"><a href="#create_connection-658"><span class="linenos">658</span></a>        <span class="n">sslopt</span><span class="o">=</span><span class="n">sslopt</span><span class="p">,</span>
</span><span id="create_connection-659"><a href="#create_connection-659"><span class="linenos">659</span></a>        <span class="n">fire_cont_frame</span><span class="o">=</span><span class="n">fire_cont_frame</span><span class="p">,</span>
</span><span id="create_connection-660"><a href="#create_connection-660"><span class="linenos">660</span></a>        <span class="n">enable_multithread</span><span class="o">=</span><span class="n">enable_multithread</span><span class="p">,</span>
</span><span id="create_connection-661"><a href="#create_connection-661"><span class="linenos">661</span></a>        <span class="n">skip_utf8_validation</span><span class="o">=</span><span class="n">skip_utf8_validation</span><span class="p">,</span>
</span><span id="create_connection-662"><a href="#create_connection-662"><span class="linenos">662</span></a>        <span class="o">**</span><span class="n">options</span><span class="p">,</span>
</span><span id="create_connection-663"><a href="#create_connection-663"><span class="linenos">663</span></a>    <span class="p">)</span>
</span><span id="create_connection-664"><a href="#create_connection-664"><span class="linenos">664</span></a>    <span class="n">websock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">timeout</span> <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">getdefaulttimeout</span><span class="p">())</span>
</span><span id="create_connection-665"><a href="#create_connection-665"><span class="linenos">665</span></a>    <span class="n">websock</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="create_connection-666"><a href="#create_connection-666"><span class="linenos">666</span></a>    <span class="k">return</span> <span class="n">websock</span>
</span></pre></div>


            <div class="docstring"><p>Connect to url and return websocket object.</p>

<p>Connect to url and return the WebSocket object.
Passing optional timeout parameter will set the timeout on the socket.
If no timeout is supplied,
the global default timeout setting returned by getdefaulttimeout() is used.
You can customize using 'options'.
If you set "header" list object, you can set your own custom header.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">create_connection</span><span class="p">(</span><span class="s2">&quot;ws://echo.websocket.events&quot;</span><span class="p">,</span>
<span class="go">     ...     header=[&quot;User-Agent: MyProgram&quot;,</span>
<span class="go">     ...             &quot;x-custom: header&quot;])</span>
</code></pre>
</div>

<h2 id="parameters">Parameters</h2>

<p>class_: class
    class to instantiate when creating the connection. It has to implement
    settimeout and connect. It's __init__ should be compatible with
    <a href="#WebSocket.__init__">WebSocket.__init__</a>, i.e. accept all of it's kwargs.
header: list or dict
    custom http header list or dict.
cookie: str
    Cookie value.
origin: str
    custom origin url.
suppress_origin: bool
    suppress outputting origin header.
host: str
    custom host header string.
timeout: int or float
    socket timeout time. This value could be either float/integer.
    If set to None, it uses the default_timeout value.
http_proxy_host: str
    HTTP proxy host name.
http_proxy_port: str or int
    HTTP proxy port. If not set, set to 80.
http_no_proxy: list
    Whitelisted host names that don't use the proxy.
http_proxy_auth: tuple
    HTTP proxy auth information. tuple of username and password. Default is None.
http_proxy_timeout: int or float
    HTTP proxy timeout, default is 60 sec as per python-socks.
enable_multithread: bool
    Enable lock for multithread.
redirect_limit: int
    Number of redirects to follow.
sockopt: tuple
    Values for socket.setsockopt.
    sockopt must be a tuple and each element is an argument of sock.setsockopt.
sslopt: dict
    Optional dict object for ssl socket options. See FAQ for details.
subprotocols: list
    List of available subprotocols. Default is None.
skip_utf8_validation: bool
    Skip utf8 validation.
socket: socket
    Pre-initialized stream socket.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>